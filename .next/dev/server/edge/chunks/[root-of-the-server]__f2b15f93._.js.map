{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n    let response = NextResponse.next({\n        request: {\n            headers: request.headers,\n        },\n    })\n\n    const supabase = createServerClient(\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n        {\n            cookies: {\n                getAll() {\n                    return request.cookies.getAll()\n                },\n                setAll(cookiesToSet) {\n                    cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))\n                    response = NextResponse.next({\n                        request: {\n                            headers: request.headers,\n                        },\n                    })\n                    cookiesToSet.forEach(({ name, value, options }) =>\n                        response.cookies.set(name, value, options)\n                    )\n                },\n            },\n        }\n    )\n\n    const {\n        data: { user },\n        error,\n    } = await supabase.auth.getUser()\n\n    const path = request.nextUrl.pathname\n    console.log(`[Middleware] ${request.method} ${path}`)\n    console.log(`[Middleware] User ID: ${user?.id || 'None'}, Error: ${error?.message || 'None'}`)\n\n    // Protected Routes\n    const protectedPaths = [\n        '/admin',\n        '/profile',\n        '/donations',\n        '/requests/new',\n        '/achievements',\n    ]\n\n    const isProtectedPath = protectedPaths.some(p => path.startsWith(p))\n\n    // Auth Routes\n    const authPaths = ['/login', '/register']\n    const isAuthPath = authPaths.some(p => path.startsWith(p))\n\n    if (isProtectedPath && !user) {\n        console.log(`[Middleware] Redirecting unauthenticated user from ${path} to /login`)\n        const redirectUrl = new URL('/login', request.url)\n        redirectUrl.searchParams.set('redirect', path)\n        return NextResponse.redirect(redirectUrl)\n    }\n\n    if (isAuthPath && user) {\n        console.log(`[Middleware] Redirecting authenticated user from ${path} to /dashboard`)\n        return NextResponse.redirect(new URL('/dashboard', request.url)) // Default logged-in home\n    }\n\n    return response\n}\n\nexport const config = {\n    matcher: [\n        '/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)',\n    ],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;AACA;AAAA;;;AAEO,eAAe,WAAW,OAAoB;IACjD,IAAI,WAAW,gMAAY,CAAC,IAAI,CAAC;QAC7B,SAAS;YACL,SAAS,QAAQ,OAAO;QAC5B;IACJ;IAEA,MAAM,WAAW,IAAA,uMAAkB,sUAG/B;QACI,SAAS;YACL;gBACI,OAAO,QAAQ,OAAO,CAAC,MAAM;YACjC;YACA,QAAO,YAAY;gBACf,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBAC7E,WAAW,gMAAY,CAAC,IAAI,CAAC;oBACzB,SAAS;wBACL,SAAS,QAAQ,OAAO;oBAC5B;gBACJ;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC1C,SAAS,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAE1C;QACJ;IACJ;IAGJ,MAAM,EACF,MAAM,EAAE,IAAI,EAAE,EACd,KAAK,EACR,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,MAAM,OAAO,QAAQ,OAAO,CAAC,QAAQ;IACrC,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,QAAQ,MAAM,CAAC,CAAC,EAAE,MAAM;IACpD,QAAQ,GAAG,CAAC,CAAC,sBAAsB,EAAE,MAAM,MAAM,OAAO,SAAS,EAAE,OAAO,WAAW,QAAQ;IAE7F,mBAAmB;IACnB,MAAM,iBAAiB;QACnB;QACA;QACA;QACA;QACA;KACH;IAED,MAAM,kBAAkB,eAAe,IAAI,CAAC,CAAA,IAAK,KAAK,UAAU,CAAC;IAEjE,cAAc;IACd,MAAM,YAAY;QAAC;QAAU;KAAY;IACzC,MAAM,aAAa,UAAU,IAAI,CAAC,CAAA,IAAK,KAAK,UAAU,CAAC;IAEvD,IAAI,mBAAmB,CAAC,MAAM;QAC1B,QAAQ,GAAG,CAAC,CAAC,mDAAmD,EAAE,KAAK,UAAU,CAAC;QAClF,MAAM,cAAc,IAAI,IAAI,UAAU,QAAQ,GAAG;QACjD,YAAY,YAAY,CAAC,GAAG,CAAC,YAAY;QACzC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IACjC;IAEA,IAAI,cAAc,MAAM;QACpB,QAAQ,GAAG,CAAC,CAAC,iDAAiD,EAAE,KAAK,cAAc,CAAC;QACpF,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG,GAAG,yBAAyB;;IAC9F;IAEA,OAAO;AACX;AAEO,MAAM,SAAS;IAClB,SAAS;QACL;KACH;AACL"}}]
}