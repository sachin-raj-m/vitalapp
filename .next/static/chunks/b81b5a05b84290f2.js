(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,29377,e=>{"use strict";let r=(0,e.i(75254).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>r],29377)},18566,(e,r,o)=>{r.exports=e.r(76562)},98791,e=>{"use strict";let r=(0,e.i(75254).default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>r],98791)},5050,e=>{"use strict";var r=e.i(43476);e.s(["Card",0,({children:e,className:o=""})=>(0,r.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${o}`,children:e}),"CardBody",0,({children:e,className:o=""})=>(0,r.jsx)("div",{className:`px-6 py-4 ${o}`,children:e}),"CardHeader",0,({children:e,className:o=""})=>(0,r.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${o}`,children:e})])},37727,e=>{"use strict";let r=(0,e.i(75254).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>r],37727)},78896,e=>{"use strict";var r=e.i(43476),o=e.i(98791),l=e.i(75254);let t=(0,l.default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),a=(0,l.default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var s=e.i(37727);e.s(["Alert",0,({title:e,children:l,variant:i="info",onClose:n,className:d=""})=>{let c={info:(0,r.jsx)(a,{className:"h-5 w-5 text-blue-400"}),success:(0,r.jsx)(t,{className:"h-5 w-5 text-green-400"}),warning:(0,r.jsx)(o.AlertCircle,{className:"h-5 w-5 text-yellow-400"}),error:(0,r.jsx)(o.AlertCircle,{className:"h-5 w-5 text-red-400"})},u=`
    rounded-md p-4
    ${{info:"bg-blue-50 text-blue-800",success:"bg-green-50 text-green-800",warning:"bg-yellow-50 text-yellow-800",error:"bg-red-50 text-red-800"}[i]}
    ${d}
  `;return(0,r.jsx)("div",{className:u,children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:c[i]}),(0,r.jsxs)("div",{className:"ml-3 flex-1",children:[e&&(0,r.jsx)("h3",{className:"text-sm font-medium",children:e}),(0,r.jsx)("div",{className:`text-sm ${e?"mt-2":""}`,children:l})]}),n&&(0,r.jsx)("div",{className:"ml-auto pl-3",children:(0,r.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,r.jsxs)("button",{type:"button",onClick:n,className:`
                  inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2
                  ${"info"===i?"text-blue-500 hover:bg-blue-100 focus:ring-blue-600":""}
                  ${"success"===i?"text-green-500 hover:bg-green-100 focus:ring-green-600":""}
                  ${"warning"===i?"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600":""}
                  ${"error"===i?"text-red-500 hover:bg-red-100 focus:ring-red-600":""}
                `,children:[(0,r.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,r.jsx)(s.X,{className:"h-5 w-5"})]})})})]})})}],78896)},1206,e=>{"use strict";var r=e.i(43476);e.s(["Input",0,({label:e,error:o,helperText:l,className:t="",...a})=>{let s=a.id||a.name||Math.random().toString(36).substring(2,9);return(0,r.jsxs)("div",{className:"mb-4",children:[e&&(0,r.jsx)("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,r.jsx)("input",{id:s,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${o?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${t}
        `,...a}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-error-500",children:o}),l&&!o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:l})]})},"Select",0,({label:e,error:o,helperText:l,options:t,className:a="",...s})=>{let i=s.id||s.name||Math.random().toString(36).substring(2,9);return(0,r.jsxs)("div",{className:"mb-4",children:[e&&(0,r.jsx)("label",{htmlFor:i,className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,r.jsx)("select",{id:i,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${o?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${a}
        `,...s,children:t.map(e=>(0,r.jsx)("option",{value:e.value,children:e.label},e.value))}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-error-500",children:o}),l&&!o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:l})]})},"Textarea",0,({label:e,error:o,helperText:l,className:t="",...a})=>{let s=a.id||a.name||Math.random().toString(36).substring(2,9);return(0,r.jsxs)("div",{className:"mb-4",children:[e&&(0,r.jsx)("label",{htmlFor:s,className:"block text-sm font-medium text-gray-700 mb-1",children:e}),(0,r.jsx)("textarea",{id:s,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${o?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${t}
        `,...a}),o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-error-500",children:o}),l&&!o&&(0,r.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:l})]})}])},36271,e=>{"use strict";var r=e.i(17927);async function o(e){try{console.log("Checking registration completion for user:",e);let{data:o,error:l}=await r.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",e).single();if(l)throw console.error("Error fetching profile:",l),l;console.log("Profile data:",o);let t=!!(o&&o.full_name&&o.blood_group&&o.blood_group_proof_url);return console.log("Registration complete?",t),t}catch(e){return console.error("Error checking registration status:",e),!1}}e.s(["isRegistrationComplete",()=>o])},81928,e=>{"use strict";var r=e.i(43476),o=e.i(71645),l=e.i(18566),t=e.i(5050),a=e.i(1206),s=e.i(78896),i=e.i(76525),n=e.i(17927),d=e.i(29377),c=e.i(97815),u=e.i(36271);function m(){let e=(0,l.useRouter)(),{user:m}=(0,c.useAuth)(),[p,g]=(0,o.useState)(""),[h,f]=(0,o.useState)("loading"),[x,b]=(0,o.useState)(0),[y,j]=(0,o.useState)(null),[N,v]=(0,o.useState)({fullName:"",phone:"",bloodGroup:"",proofType:"",proofFile:null}),[w,C]=(0,o.useState)({});(0,o.useEffect)(()=>{let r=async()=>{console.log("Initializing CompleteRegistration page");try{if(!m){console.log("No user found, redirecting to login"),e.push("/login");return}console.log("Current user:",m);let r=await (0,u.isRegistrationComplete)(m.id);if(console.log("Registration status:",r),r){console.log("Registration already complete, redirecting to dashboard"),e.push("/dashboard");return}let o=localStorage.getItem("pendingRegistration");if(console.log("Stored registration data:",o),!o){console.log("No pending registration data found"),g("Registration data not found. Please register again."),e.push("/register");return}try{let e=JSON.parse(o);if(console.log("Parsed registration data:",e),e.userId!==m.id)throw console.log("User ID mismatch:",{stored:e.userId,current:m.id}),Error("User ID mismatch");j(e),e.phone&&v(r=>({...r,phone:e.phone})),f("form")}catch(e){throw console.error("Error processing stored data:",e),Error("Invalid registration data")}}catch(r){console.error("Initialization error:",r),g(r.message||"Failed to load registration data"),e.push("/register")}};void 0!==m&&r()},[e,m]);let _=async r=>{let o;if(r.preventDefault(),o={},N.fullName.trim()||(o.fullName="Full name is required"),N.phone.trim()||(o.phone="Phone number is required"),N.bloodGroup||(o.bloodGroup="Blood group is required"),N.proofType||(o.proofType="Please select proof type"),N.proofFile?N.proofFile.size>1048576&&(o.proofFile="File size must be less than 1MB"):o.proofFile="Please upload proof document",C(o),0===Object.keys(o).length&&y){f("uploading"),b(25);try{let{data:{session:r},error:o}=await n.supabase.auth.getSession();if(o)throw o;if(!r){g("Authentication required. Please sign in again."),e.push("/login");return}if(r.user.id!==y.userId){g("Session mismatch. Please register again."),e.push("/register");return}let l=`${r.user.id}/${Date.now()}-${N.proofFile.name}`,{error:t}=await n.supabase.storage.from("proofs").upload(l,N.proofFile,{upsert:!1,contentType:N.proofFile.type});if(t)throw t;b(50),f("creating_profile");let{error:a}=await n.supabase.from("profiles").upsert({id:r.user.id,email:y.email,full_name:N.fullName,phone:N.phone,blood_group:N.bloodGroup,blood_group_proof_type:N.proofType,blood_group_proof_url:l,is_donor:!0,is_available:!0,location:{latitude:0,longitude:0,address:""}},{onConflict:"id",ignoreDuplicates:!1});if(a)throw a;b(75),f("finalizing");let{error:s}=await n.supabase.auth.updateUser({data:{registration_completed:!0,phone:N.phone}});if(s)throw s;b(100),f("completed"),localStorage.removeItem("pendingRegistration"),setTimeout(()=>e.push("/dashboard"),1500)}catch(e){console.error("Registration completion error:",e),g(e.message||"Failed to complete registration"),f("error")}}},F=e=>{let r=e.target.files?.[0];r&&(r.size>1048576?C(e=>({...e,proofFile:"File size must be less than 1MB"})):(C(e=>{let r={...e};return delete r.proofFile,r}),v(e=>({...e,proofFile:r}))))};return(0,r.jsx)("div",{className:"max-w-md mx-auto",children:(0,r.jsx)(t.Card,{children:(0,r.jsx)(t.CardBody,{className:"text-center py-8",children:(()=>{switch(h){case"loading":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Loading Registration Data"}),(0,r.jsx)(d.Loader2,{className:"h-8 w-8 animate-spin text-primary-500"})]});case"form":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Complete Your Registration"}),p&&(0,r.jsx)(s.Alert,{variant:"error",className:"mb-4",children:p}),(0,r.jsxs)("form",{onSubmit:_,className:"space-y-4",children:[(0,r.jsx)(a.Input,{label:"Full Name",value:N.fullName,onChange:e=>v({...N,fullName:e.target.value}),required:!0,autoComplete:"name",placeholder:"Enter your full name",error:w.fullName}),(0,r.jsx)(a.Input,{label:"Phone Number",type:"tel",value:N.phone,onChange:e=>v({...N,phone:e.target.value}),required:!0,autoComplete:"tel",placeholder:"Enter your phone number",error:w.phone}),(0,r.jsx)(a.Select,{label:"Blood Group",value:N.bloodGroup,onChange:e=>v({...N,bloodGroup:e.target.value}),options:[{value:"",label:"Select Blood Group"},{value:"A+",label:"A+"},{value:"A-",label:"A-"},{value:"B+",label:"B+"},{value:"B-",label:"B-"},{value:"AB+",label:"AB+"},{value:"AB-",label:"AB-"},{value:"O+",label:"O+"},{value:"O-",label:"O-"}],required:!0,error:w.bloodGroup}),(0,r.jsx)(a.Select,{label:"Blood Group Proof Type",value:N.proofType,onChange:e=>v({...N,proofType:e.target.value}),options:[{value:"",label:"Select Proof Type"},{value:"medical_certificate",label:"Medical Certificate"},{value:"hospital_report",label:"Hospital Report"},{value:"blood_donation_card",label:"Blood Donation Card"},{value:"lab_report",label:"Laboratory Report"}],required:!0,error:w.proofType}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Proof"}),(0,r.jsx)(a.Input,{type:"file",onChange:F,accept:".pdf,.jpg,.jpeg,.png",required:!0,className:"w-full",error:w.proofFile}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Accepted formats: PDF, JPG, JPEG, PNG (Max size: 1MB)"})]}),(0,r.jsx)(i.Button,{type:"submit",variant:"primary",className:"w-full",children:"Complete Registration"})]})]});case"uploading":case"creating_profile":case"finalizing":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Completing Registration"}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-4",children:(0,r.jsx)("div",{className:"bg-primary-500 h-2.5 rounded-full transition-all duration-500",style:{width:`${x}%`}})}),(0,r.jsxs)("p",{className:"text-gray-600",children:["uploading"===h&&"Uploading your documents...","creating_profile"===h&&"Creating your profile...","finalizing"===h&&"Finalizing your registration..."]})]});case"completed":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-green-600 mb-4",children:"Registration Complete!"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Your account has been successfully set up."}),(0,r.jsx)("p",{className:"text-gray-600",children:"Redirecting you to the dashboard..."})]});case"error":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-4",children:"Registration Error"}),(0,r.jsx)(s.Alert,{variant:"error",className:"mb-4",children:p}),(0,r.jsx)(i.Button,{variant:"primary",onClick:()=>e.push("/register"),className:"w-full",children:"Try Again"})]})}})()})})})}e.s(["default",()=>m])}]);