(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5631,e=>{"use strict";let t=(0,e.i(75254).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],5631)},78896,98791,e=>{"use strict";var t=e.i(43476),l=e.i(75254);let s=(0,l.default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>s],98791);var r=e.i(5631);let a=(0,l.default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var n=e.i(37727);e.s(["Alert",0,({title:e,children:l,variant:o="info",onClose:i,className:c=""})=>{let d={info:(0,t.jsx)(a,{className:"h-5 w-5 text-blue-400"}),success:(0,t.jsx)(r.CheckCircle,{className:"h-5 w-5 text-green-400"}),warning:(0,t.jsx)(s,{className:"h-5 w-5 text-yellow-400"}),error:(0,t.jsx)(s,{className:"h-5 w-5 text-red-400"})},u=`
    rounded-md p-4
    ${{info:"bg-blue-50 text-blue-800",success:"bg-green-50 text-green-800",warning:"bg-yellow-50 text-yellow-800",error:"bg-red-50 text-red-800"}[o]}
    ${c}
  `;return(0,t.jsx)("div",{className:u,children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:d[o]}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[e&&(0,t.jsx)("h3",{className:"text-sm font-medium",children:e}),(0,t.jsx)("div",{className:`text-sm ${e?"mt-2":""}`,children:l})]}),i&&(0,t.jsx)("div",{className:"ml-auto pl-3",children:(0,t.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,t.jsxs)("button",{type:"button",onClick:i,className:`
                  inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2
                  ${"info"===o?"text-blue-500 hover:bg-blue-100 focus:ring-blue-600":""}
                  ${"success"===o?"text-green-500 hover:bg-green-100 focus:ring-green-600":""}
                  ${"warning"===o?"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600":""}
                  ${"error"===o?"text-red-500 hover:bg-red-100 focus:ring-red-600":""}
                `,children:[(0,t.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,t.jsx)(n.X,{className:"h-5 w-5"})]})})})]})})}],78896)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},67585,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"BailoutToCSR",{enumerable:!0,get:function(){return r}});let s=e.r(32061);function r({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new s.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,l)=>{"use strict";function s(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"encodeURIPath",{enumerable:!0,get:function(){return s}})},52157,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"PreloadChunks",{enumerable:!0,get:function(){return o}});let s=e.r(43476),r=e.r(74080),a=e.r(63599),n=e.r(9885);function o({moduleIds:e}){if("undefined"!=typeof window)return null;let t=a.workAsyncStorage.getStore();if(void 0===t)return null;let l=[];if(t.reactLoadableManifest&&e){let s=t.reactLoadableManifest;for(let t of e){if(!s[t])continue;let e=s[t].files;l.push(...e)}}return 0===l.length?null:(0,s.jsx)(s.Fragment,{children:l.map(e=>{let l=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,s.jsx)("link",{precedence:"dynamic",href:l,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,r.preload)(l,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return c}});let s=e.r(43476),r=e.r(71645),a=e.r(67585),n=e.r(52157);function o(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...i,...e},l=(0,r.lazy)(()=>t.loader().then(o)),c=t.loading;function d(e){let o=c?(0,s.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?r.Suspense:r.Fragment,u=t.ssr?(0,s.jsxs)(s.Fragment,{children:["undefined"==typeof window?(0,s.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,s.jsx)(l,{...e})]}):(0,s.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,s.jsx)(l,{...e})});return(0,s.jsx)(d,{...i?{fallback:o}:{},children:u})}return d.displayName="LoadableComponent",d}},70703,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return r}});let s=e.r(55682)._(e.r(69093));function r(e,t){let l={};"function"==typeof e&&(l.loader=e);let r={...l,...t};return(0,s.default)({...r,modules:r.loadableGenerated?.modules})}("function"==typeof l.default||"object"==typeof l.default&&null!==l.default)&&void 0===l.default.__esModule&&(Object.defineProperty(l.default,"__esModule",{value:!0}),Object.assign(l.default,l),t.exports=l.default)},73416,e=>{"use strict";var t=e.i(43476),l=e.i(71645),s=e.i(70703),r=e.i(17927),a=e.i(76525),n=e.i(5050),o=e.i(46897),i=e.i(43432);let c=(0,e.i(75254).default)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var d=e.i(78896);let u=(0,s.default)(()=>e.A(9585),{loadableGenerated:{modules:[5481]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-[500px] w-full bg-gray-100 animate-pulse rounded-lg"})});function f(){let[e,s]=(0,l.useState)({lat:20.5937,lng:78.9629}),[f,m]=(0,l.useState)([]),[x,p]=(0,l.useState)([]),[h,g]=(0,l.useState)(!0),[y,b]=(0,l.useState)(""),[j,v]=(0,l.useState)(""),[w,N]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await r.supabase.from("profiles").select("id, full_name, blood_group, phone, location, present_zip").eq("is_donor",!0);if(t)throw t;let l=e?.map(e=>({...e,location:"string"==typeof e.location?JSON.parse(e.location):e.location}))||[],s=new Set;l.forEach(e=>{(!e.location?.latitude||0===e.location.latitude)&&e.present_zip&&s.add(e.present_zip)});let a={...w},n=!1;for(let e of Array.from(s))if(!a[e])try{let t=await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${e}&country=India&format=json&limit=1`,{headers:{"User-Agent":"VitalBloodApp/1.0"}}),l=await t.json();l&&l.length>0&&(a[e]={lat:parseFloat(l[0].lat),lng:parseFloat(l[0].lon)},n=!0,await new Promise(e=>setTimeout(e,1e3)))}catch(t){console.error(`Failed to geocode zip ${e}`,t)}n&&N(a);let o=l.map(e=>(!e.location?.latitude||0===e.location.latitude)&&e.present_zip&&a[e.present_zip]?{...e,location:{...e.location,latitude:a[e.present_zip].lat,longitude:a[e.present_zip].lng,address:e.location?.address||`Zip: ${e.present_zip}`}}:e);m(o)}catch(e){console.error("Error fetching donors"),b(e.message)}finally{g(!1)}})()},[]);let _=(0,l.useCallback)(()=>{if(v("Locating..."),!("geolocation"in navigator)){b("Geolocation not supported by your browser."),v("");return}navigator.geolocation.getCurrentPosition(e=>{s({lat:e.coords.latitude,lng:e.coords.longitude}),v("")},e=>{b("Unable to get your location: "+e.message),v("")},{enableHighAccuracy:!0,timeout:1e4})},[]);return(0,l.useEffect)(()=>{p(f.filter(e=>e.location&&e.location.latitude&&e.location.longitude).map(t=>{var l,s,r,a;let n,o,i,c,d=(l=e.lat,s=e.lng,r=t.location.latitude,a=t.location.longitude,o=(n=e=>e*Math.PI/180)(r-l),i=n(a-s),2*Math.atan2(Math.sqrt(c=Math.sin(o/2)**2+Math.cos(n(l))*Math.cos(n(r))*Math.sin(i/2)**2),Math.sqrt(1-c))*6371);return{...t,distanceKm:d}}).sort((e,t)=>(e.distanceKm||0)-(t.distanceKm||0)).slice(0,20))},[e,f]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Nearby Donors"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Find registered donors in your area"})]}),(0,t.jsx)(a.Button,{onClick:_,leftIcon:(0,t.jsx)(c,{className:"h-4 w-4"}),disabled:!!j,children:j||"Use My Location"})]}),y&&(0,t.jsx)(d.Alert,{variant:"error",children:y}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,t.jsx)("div",{className:"lg:col-span-2 h-[500px] border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:(0,t.jsx)(u,{center:e,zoom:11,markers:[{position:e,title:"You are here"},...x.map(e=>({position:{lat:e.location.latitude,lng:e.location.longitude},title:e.full_name,description:`${e.blood_group} | ${e.distanceKm?.toFixed(1)} km away`}))]})}),(0,t.jsxs)("div",{className:"lg:col-span-1 space-y-4 h-[500px] overflow-y-auto pr-2 custom-scrollbar",children:[(0,t.jsxs)("h2",{className:"font-semibold text-gray-700 bg-gray-50 p-2 rounded",children:["Closest Donors (",x.length,")"]}),0===x.length?(0,t.jsx)("p",{className:"text-gray-500 text-center py-8",children:"No donors found nearby. Try expanding your search or waiting for donors to load."}):x.map(e=>(0,t.jsx)(n.Card,{className:"hover:shadow-md transition-shadow",children:(0,t.jsxs)(n.CardBody,{className:"p-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900 flex items-center",children:e.full_name}),(0,t.jsx)("span",{className:"inline-block bg-primary-100 text-primary-800 text-xs px-2 py-0.5 rounded-full font-bold mt-1",children:e.blood_group})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsxs)("p",{className:"text-sm font-medium text-gray-900",children:[e.distanceKm?.toFixed(1)," km"]}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"away"})]})]}),(0,t.jsxs)("div",{className:"mt-3 pt-3 border-t border-gray-100 flex justify-between items-center",children:[e.phone?(0,t.jsxs)("a",{href:`tel:${e.phone}`,className:"text-sm text-secondary-600 hover:text-secondary-700 flex items-center font-medium",children:[(0,t.jsx)(i.Phone,{className:"h-3 w-3 mr-1"}),"Call Now"]}):(0,t.jsx)("span",{className:"text-xs text-gray-400 italic",children:"No phone shared"}),(0,t.jsxs)("div",{className:"flex items-center text-xs text-gray-500",children:[(0,t.jsx)(o.MapPin,{className:"h-3 w-3 mr-1"}),e.location.address?.split(",")[0]||"Unknown Location"]})]})]})},e.id))]})]})]})}e.s(["default",()=>f],73416)},9585,e=>{e.v(t=>Promise.all(["static/chunks/ee1cdecac3f5b108.js","static/chunks/076efda0d0cae75b.css"].map(t=>e.l(t))).then(()=>t(5481)))}]);