(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,29377,e=>{"use strict";let t=(0,e.i(75254).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],29377)},5050,e=>{"use strict";var t=e.i(43476);e.s(["Card",0,({children:e,className:s=""})=>(0,t.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${s}`,children:e}),"CardBody",0,({children:e,className:s=""})=>(0,t.jsx)("div",{className:`px-6 py-4 ${s}`,children:e}),"CardHeader",0,({children:e,className:s=""})=>(0,t.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${s}`,children:e})])},18566,(e,t,s)=>{t.exports=e.r(76562)},36271,e=>{"use strict";var t=e.i(17927);async function s(e){try{let{data:s,error:r}=await t.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",e).single();if(r)throw console.error("Error fetching profile:",r),r;return!!(s&&s.full_name&&s.blood_group&&s.blood_group_proof_url)}catch(e){return console.error("Error checking registration status:",e),!1}}e.s(["isRegistrationComplete",()=>s])},42711,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(17927),i=e.i(97815);let a=(0,s.createContext)(void 0);function l({children:e}){let{user:l}=(0,i.useAuth)(),[o,n]=(0,s.useState)([]),[c,u]=(0,s.useState)(new Set),[d,m]=(0,s.useState)(!0),[h,x]=(0,s.useState)(null),f=(0,s.useCallback)(async()=>{try{m(!0),x(null);let{data:e,error:t}=await r.supabase.from("blood_requests").select("*").eq("status","active").order("created_at",{ascending:!1});if(t)throw t;if(n(e||[]),l){let{data:e,error:t}=await r.supabase.from("donations").select("request_id").eq("donor_id",l.id).neq("status","cancelled");!t&&e&&u(new Set(e.map(e=>e.request_id)))}else u(new Set)}catch(e){console.error("Error in RequestsContext:",e),x(e)}finally{m(!1)}},[l]);return(0,s.useEffect)(()=>{f();let e=r.supabase.channel("public_requests").on("postgres_changes",{event:"*",schema:"public",table:"blood_requests"},()=>{console.log("Real-time update: Refreshing requests..."),f()}).subscribe();return()=>{r.supabase.removeChannel(e)}},[f,l]),(0,t.jsx)(a.Provider,{value:{requests:o,myDonations:c,loading:d,error:h,refreshRequests:f},children:e})}e.s(["RequestsProvider",()=>l,"useRequests",0,()=>{let e=(0,s.useContext)(a);if(void 0===e)throw Error("useRequests must be used within a RequestsProvider");return e}])},43432,e=>{"use strict";let t=(0,e.i(75254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>t],43432)},63488,e=>{"use strict";let t=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],63488)},3578,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(97815),i=e.i(18566);function a({children:e}){let{user:a,session:l,loading:o,error:n,refreshProfile:c}=(0,r.useAuth)(),u=(0,i.useRouter)(),d=(0,i.usePathname)(),[m,h]=(0,s.useState)(0);return((0,s.useEffect)(()=>{l?.user?.id&&!a&&!o&&m<3&&(c(),h(e=>e+1))},[l,a,o,c,m]),(0,s.useEffect)(()=>{a&&l||o&&!(m>=3)||u.push(`/login?from=${d}`)},[a,l,o,m,u,d]),o)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your dashboard."})]})}):a&&l||o&&!(m>=3)?(0,t.jsx)(t.Fragment,{children:e}):null}var l=e.i(36271),o=e.i(5050),n=e.i(29377);function c({children:e}){let a=(0,i.useRouter)(),{user:c}=(0,r.useAuth)(),[u,d]=(0,s.useState)(!0);return((0,s.useEffect)(()=>{(async()=>{if(!c)return a.push("/login");try{if(await (0,l.isRegistrationComplete)(c.id))d(!1);else{let e={userId:c.id,email:c.email,phone:c.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(e)),a.push("/complete-registration")}}catch(t){console.error("RegistrationGuard: Error checking registration:",t);let e={userId:c.id,email:c.email,phone:c.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(e)),a.push("/complete-registration")}})()},[c,a]),u)?(0,t.jsx)("div",{className:"max-w-md mx-auto",children:(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardBody,{className:"text-center py-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Checking Profile"}),(0,t.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-primary-500 mx-auto"})]})})}):(0,t.jsx)(t.Fragment,{children:e})}var u=e.i(76525),d=e.i(17927),m=e.i(63488),h=e.i(43432),x=e.i(37727);let f=()=>{let{session:e,user:i}=(0,r.useAuth)(),[a,l]=(0,s.useState)(!0),[o,n]=(0,s.useState)(null),[c,f]=(0,s.useState)(null),[p,g]=(0,s.useState)("");if(!e?.user||!a)return null;let y=e.user.email_confirmed_at,w=e.user.phone_confirmed_at;if(y&&(w||!i?.phone))return null;let b=(i?.phone||e.user.phone)&&!w;if(!b&&y)return null;let v=async()=>{n("email"),g("");try{let{error:t}=await d.supabase.auth.resend({type:"signup",email:e.user.email,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(t)throw t;f("email")}catch(e){console.error("Error sending verification email"),g(e.message||"Failed to send verification email")}finally{n(null)}},j=async()=>{window.location.href="/profile"};return(0,t.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200 p-4 relative",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-yellow-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-yellow-200 text-yellow-700 text-xs font-bold",children:"!"}),"Account Verification"]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-yellow-700",children:!y&&b?"Please verify your email and phone number to secure your account.":y?"Please verify your phone number to secure your account.":"Please verify your email address to secure your account."}),p&&(0,t.jsx)("p",{className:"mt-1 text-xs text-red-600",children:p}),"email"===c&&(0,t.jsx)("p",{className:"mt-1 text-xs text-green-600",children:"Verification email sent!"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[!y&&"email"!==c&&(0,t.jsx)(u.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:v,isLoading:"email"===o,leftIcon:(0,t.jsx)(m.Mail,{className:"h-3 w-3"}),children:"Verify Email"}),b&&(0,t.jsx)(u.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:j,leftIcon:(0,t.jsx)(h.Phone,{className:"h-3 w-3"}),children:"Verify Phone"}),(0,t.jsx)("button",{onClick:()=>l(!1),className:"text-yellow-500 hover:text-yellow-700 p-1","aria-label":"Dismiss",children:(0,t.jsx)(x.X,{className:"h-5 w-5"})})]})]})})};var p=e.i(42711);function g({children:e}){return(0,t.jsx)(a,{children:(0,t.jsx)(c,{children:(0,t.jsx)(p.RequestsProvider,{children:(0,t.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,t.jsx)(f,{}),e]})})})})}e.s(["default",()=>g],3578)}]);