(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,46897,e=>{"use strict";let t=(0,e.i(75254).default)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},67585,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"BailoutToCSR",{enumerable:!0,get:function(){return a}});let l=e.r(32061);function a({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new l.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,r)=>{"use strict";function l(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"encodeURIPath",{enumerable:!0,get:function(){return l}})},52157,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"PreloadChunks",{enumerable:!0,get:function(){return s}});let l=e.r(43476),a=e.r(74080),o=e.r(63599),n=e.r(9885);function s({moduleIds:e}){if("undefined"!=typeof window)return null;let t=o.workAsyncStorage.getStore();if(void 0===t)return null;let r=[];if(t.reactLoadableManifest&&e){let l=t.reactLoadableManifest;for(let t of e){if(!l[t])continue;let e=l[t].files;r.push(...e)}}return 0===r.length?null:(0,l.jsx)(l.Fragment,{children:r.map(e=>{let r=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,l.jsx)("link",{precedence:"dynamic",href:r,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,a.preload)(r,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return d}});let l=e.r(43476),a=e.r(71645),o=e.r(67585),n=e.r(52157);function s(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(s(()=>null)),loading:null,ssr:!0},d=function(e){let t={...i,...e},r=(0,a.lazy)(()=>t.loader().then(s)),d=t.loading;function c(e){let s=d?(0,l.jsx)(d,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,c=i?a.Suspense:a.Fragment,u=t.ssr?(0,l.jsxs)(l.Fragment,{children:["undefined"==typeof window?(0,l.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,l.jsx)(r,{...e})]}):(0,l.jsx)(o.BailoutToCSR,{reason:"next/dynamic",children:(0,l.jsx)(r,{...e})});return(0,l.jsx)(c,{...i?{fallback:s}:{},children:u})}return c.displayName="LoadableComponent",c}},70703,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"default",{enumerable:!0,get:function(){return a}});let l=e.r(55682)._(e.r(69093));function a(e,t){let r={};"function"==typeof e&&(r.loader=e);let a={...r,...t};return(0,l.default)({...a,modules:a.loadableGenerated?.modules})}("function"==typeof r.default||"object"==typeof r.default&&null!==r.default)&&void 0===r.default.__esModule&&(Object.defineProperty(r.default,"__esModule",{value:!0}),Object.assign(r.default,r),t.exports=r.default)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>t],55436)},73416,e=>{"use strict";var t=e.i(43476),r=e.i(71645),l=e.i(70703),a=e.i(17927),o=e.i(76525),n=e.i(46897);let s=(0,e.i(75254).default)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var i=e.i(55436),d=e.i(78896),c=e.i(97815);let u=(0,l.default)(()=>e.A(9585),{loadableGenerated:{modules:[5481]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-full w-full bg-gray-100 animate-pulse rounded-xl flex items-center justify-center text-gray-400",children:"Loading Map..."})});function f(){let{user:e}=(0,c.useAuth)(),[l,f]=(0,r.useState)({lat:20.5937,lng:78.9629}),[m,p]=(0,r.useState)([]),[x,g]=(0,r.useState)([]),[h,y]=(0,r.useState)(!0),[b,j]=(0,r.useState)(""),[v,w]=(0,r.useState)(""),[N,_]=(0,r.useState)({});(0,r.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await a.supabase.from("profiles").select("id, full_name, blood_group, location, present_zip").eq("is_donor",!0);if(t)throw t;let r=e?.map(e=>({...e,location:"string"==typeof e.location?JSON.parse(e.location):e.location}))||[],l=new Set;r.forEach(e=>{(!e.location?.latitude||0===e.location.latitude)&&e.present_zip&&l.add(e.present_zip)});let o={...N},n=!1;for(let e of Array.from(l).slice(0,5))if(!o[e])try{let t=await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${e}&country=India&format=json&limit=1`,{headers:{"User-Agent":"VitalBloodApp/1.0"}}),r=await t.json();r&&r.length>0&&(o[e]={lat:parseFloat(r[0].lat),lng:parseFloat(r[0].lon)},n=!0,await new Promise(e=>setTimeout(e,800)))}catch(t){console.error(`Failed to geocode zip ${e}`,t)}n&&_(o);let s=r.map(e=>(!e.location?.latitude||0===e.location.latitude)&&e.present_zip&&o[e.present_zip]?{...e,location:{...e.location,latitude:o[e.present_zip].lat,longitude:o[e.present_zip].lng,address:e.location?.address||`Zip: ${e.present_zip}`}}:e);p(s)}catch(e){console.error("Error fetching donors",e),j(e.message)}finally{y(!1)}})()},[]);let P=(0,r.useCallback)(()=>{if(w("Locating..."),!("geolocation"in navigator)){j("Geolocation not supported by your browser."),w("");return}navigator.geolocation.getCurrentPosition(e=>{f({lat:e.coords.latitude,lng:e.coords.longitude}),w("")},e=>{j("Unable to get your location: "+e.message),w("")},{enableHighAccuracy:!0,timeout:1e4})},[]);return(0,r.useEffect)(()=>{g(m.filter(t=>t.id!==e?.id&&t.location&&void 0!==t.location.latitude&&null!==t.location.latitude&&void 0!==t.location.longitude&&null!==t.location.longitude).map(e=>{var t,r,a,o;let n,s,i,d,c=(t=l.lat,r=l.lng,a=e.location.latitude,o=e.location.longitude,s=(n=e=>e*Math.PI/180)(a-t),i=n(o-r),2*Math.atan2(Math.sqrt(d=Math.sin(s/2)**2+Math.cos(n(t))*Math.cos(n(a))*Math.sin(i/2)**2),Math.sqrt(1-d))*6371);return{...e,distanceKm:c}}).sort((e,t)=>(e.distanceKm||0)-(t.distanceKm||0)).slice(0,20))},[l,m,e]),(0,t.jsxs)("div",{className:"space-y-6 h-[calc(100vh-140px)] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Find Donors Nearby"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Discover life-savers in your vicinity"})]}),(0,t.jsx)(o.Button,{onClick:P,leftIcon:v?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):(0,t.jsx)(s,{className:"h-4 w-4"}),disabled:!!v,className:"shadow-sm transition-all hover:shadow-md active:scale-95",children:v||"Use My Location"})]}),b&&(0,t.jsx)(d.Alert,{variant:"error",className:"flex-shrink-0",children:b}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow min-h-0",children:[(0,t.jsx)("div",{className:"lg:col-span-8 h-[400px] lg:h-full rounded-2xl overflow-hidden border border-gray-200 shadow-sm relative group bg-gray-50",children:(0,t.jsx)(u,{center:l,zoom:11,markers:[{position:l,title:"You are here"},...x.map(e=>({position:{lat:e.location.latitude,lng:e.location.longitude},title:e.full_name,description:`${e.blood_group} | ${e.distanceKm?.toFixed(1)} km away`}))]})}),(0,t.jsxs)("div",{className:"lg:col-span-4 flex flex-col h-full min-h-0 bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[(0,t.jsxs)("h2",{className:"font-semibold text-gray-800 flex items-center",children:[(0,t.jsx)(i.Search,{className:"w-4 h-4 mr-2 text-gray-400"}),"Closest Donors"]}),(0,t.jsxs)("span",{className:"bg-white text-gray-600 px-2 py-0.5 rounded-full text-xs font-medium border border-gray-200",children:[x.length," found"]})]}),(0,t.jsx)("div",{className:"overflow-y-auto p-4 space-y-3 custom-scrollbar flex-grow",children:0===x.length?(0,t.jsxs)("div",{className:"text-center py-12 flex flex-col items-center justify-center opacity-60",children:[(0,t.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-3",children:(0,t.jsx)(n.MapPin,{className:"h-8 w-8 text-gray-400"})}),(0,t.jsx)("p",{className:"text-gray-900 font-medium",children:"No donors found nearby"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1 max-w-[200px]",children:"Try using your current location or expanding your search area."})]}):x.map(e=>(0,t.jsxs)("div",{onClick:()=>f({lat:e.location.latitude,lng:e.location.longitude}),className:"group flex items-center p-3 rounded-xl border border-gray-100 hover:border-primary-100 hover:bg-primary-50/30 transition-all duration-200 cursor-pointer",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-500 font-bold text-lg shadow-inner flex-shrink-0",children:e.full_name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),(0,t.jsxs)("div",{className:"ml-3 flex-grow min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 truncate pr-2",children:e.full_name}),(0,t.jsx)("span",{className:`text-xs font-bold px-2 py-0.5 rounded border ${e.blood_group.includes("+")?"bg-rose-100 text-rose-700 border-rose-200":"bg-indigo-100 text-indigo-700 border-indigo-200"}`,children:e.blood_group})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,t.jsx)("div",{className:"flex items-center text-xs text-gray-500",children:e.present_zip?(0,t.jsx)("span",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 font-mono",children:e.present_zip}):(0,t.jsx)("span",{className:"text-gray-400 italic",children:"Zip N/A"})}),(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-500 flex items-center",children:[(0,t.jsx)(n.MapPin,{className:"w-3 h-3 mr-1 text-gray-400"}),e.distanceKm?.toFixed(1)," km"]})]})]})]},e.id))})]})]})]})}e.s(["default",()=>f],73416)},9585,e=>{e.v(t=>Promise.all(["static/chunks/81308917bb7a5a99.js","static/chunks/076efda0d0cae75b.css"].map(t=>e.l(t))).then(()=>t(5481)))}]);