(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5050,e=>{"use strict";var t=e.i(43476);e.s(["Card",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${r}`,children:e}),"CardBody",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`px-6 py-4 ${r}`,children:e}),"CardHeader",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${r}`,children:e})])},29377,e=>{"use strict";let t=(0,e.i(75254).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],29377)},18566,(e,t,r)=>{t.exports=e.r(76562)},36271,e=>{"use strict";var t=e.i(17927);async function r(e){try{let{data:r,error:s}=await t.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",e).single();if(s)throw console.error("Error fetching profile:",s),s;return!!(r&&r.full_name&&r.blood_group&&r.blood_group_proof_url)}catch(e){return console.error("Error checking registration status:",e),!1}}e.s(["isRegistrationComplete",()=>r])},43432,e=>{"use strict";let t=(0,e.i(75254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>t],43432)},63488,e=>{"use strict";let t=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],63488)},3578,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(97815),l=e.i(18566);function i({children:e}){let{user:i,session:a,loading:o,error:n,refreshProfile:c}=(0,s.useAuth)(),d=(0,l.useRouter)(),u=(0,l.usePathname)(),[m,h]=(0,r.useState)(0);return((0,r.useEffect)(()=>{a?.user?.id&&!i&&!o&&m<3&&(c(),h(e=>e+1))},[a,i,o,c,m]),(0,r.useEffect)(()=>{i&&a||o&&!(m>=3)||d.push(`/login?from=${u}`)},[i,a,o,m,d,u]),o)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your dashboard."})]})}):i&&a||o&&!(m>=3)?(0,t.jsx)(t.Fragment,{children:e}):null}var a=e.i(36271),o=e.i(5050),n=e.i(29377);function c({children:e}){let i=(0,l.useRouter)(),{user:c}=(0,s.useAuth)(),[d,u]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{if(!c)return i.push("/login");try{if(await (0,a.isRegistrationComplete)(c.id))u(!1);else{let e={userId:c.id,email:c.email,phone:c.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(e)),i.push("/complete-registration")}}catch(t){console.error("RegistrationGuard: Error checking registration:",t);let e={userId:c.id,email:c.email,phone:c.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(e)),i.push("/complete-registration")}})()},[c,i]),d)?(0,t.jsx)("div",{className:"max-w-md mx-auto",children:(0,t.jsx)(o.Card,{children:(0,t.jsxs)(o.CardBody,{className:"text-center py-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Checking Profile"}),(0,t.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-primary-500 mx-auto"})]})})}):(0,t.jsx)(t.Fragment,{children:e})}var d=e.i(76525),u=e.i(17927),m=e.i(63488),h=e.i(43432),x=e.i(37727);let f=()=>{let{session:e,user:l}=(0,s.useAuth)(),[i,a]=(0,r.useState)(!0),[o,n]=(0,r.useState)(null),[c,f]=(0,r.useState)(null),[p,y]=(0,r.useState)("");if(!e?.user||!i)return null;let g=e.user.email_confirmed_at,w=e.user.phone_confirmed_at;if(g&&(w||!l?.phone))return null;let j=(l?.phone||e.user.phone)&&!w;if(!j&&g)return null;let b=async()=>{n("email"),y("");try{let{error:t}=await u.supabase.auth.resend({type:"signup",email:e.user.email,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(t)throw t;f("email")}catch(e){console.error("Error sending verification email"),y(e.message||"Failed to send verification email")}finally{n(null)}},v=async()=>{window.location.href="/profile"};return(0,t.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200 p-4 relative",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-yellow-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-yellow-200 text-yellow-700 text-xs font-bold",children:"!"}),"Account Verification"]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-yellow-700",children:!g&&j?"Please verify your email and phone number to secure your account.":g?"Please verify your phone number to secure your account.":"Please verify your email address to secure your account."}),p&&(0,t.jsx)("p",{className:"mt-1 text-xs text-red-600",children:p}),"email"===c&&(0,t.jsx)("p",{className:"mt-1 text-xs text-green-600",children:"Verification email sent!"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[!g&&"email"!==c&&(0,t.jsx)(d.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:b,isLoading:"email"===o,leftIcon:(0,t.jsx)(m.Mail,{className:"h-3 w-3"}),children:"Verify Email"}),j&&(0,t.jsx)(d.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:v,leftIcon:(0,t.jsx)(h.Phone,{className:"h-3 w-3"}),children:"Verify Phone"}),(0,t.jsx)("button",{onClick:()=>a(!1),className:"text-yellow-500 hover:text-yellow-700 p-1","aria-label":"Dismiss",children:(0,t.jsx)(x.X,{className:"h-5 w-5"})})]})]})})};function p({children:e}){return(0,t.jsx)(i,{children:(0,t.jsx)(c,{children:(0,t.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,t.jsx)(f,{}),e]})})})}e.s(["default",()=>p],3578)}]);