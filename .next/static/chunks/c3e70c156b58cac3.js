(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,42711,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(17927),u=e.i(97815);let a=(0,s.createContext)(void 0);function o({children:e}){let{user:o}=(0,u.useAuth)(),[i,n]=(0,s.useState)([]),[l,c]=(0,s.useState)(new Set),[d,b]=(0,s.useState)(!0),[h,q]=(0,s.useState)(null),f=(0,s.useCallback)(async()=>{try{b(!0),q(null);let{data:e,error:t}=await r.supabase.from("blood_requests").select("*").eq("status","active").order("created_at",{ascending:!1});if(t)throw t;if(n(e||[]),o){let{data:e,error:t}=await r.supabase.from("donations").select("request_id").eq("donor_id",o.id).neq("status","cancelled");!t&&e&&c(new Set(e.map(e=>e.request_id)))}else c(new Set)}catch(e){console.error("Error in RequestsContext:",e),q(e)}finally{b(!1)}},[o]);return(0,s.useEffect)(()=>{f();let e=r.supabase.channel("public_requests").on("postgres_changes",{event:"*",schema:"public",table:"blood_requests"},()=>{console.log("Real-time update: Refreshing requests..."),f()}).subscribe();return()=>{r.supabase.removeChannel(e)}},[f,o]),(0,t.jsx)(a.Provider,{value:{requests:i,myDonations:l,loading:d,error:h,refreshRequests:f},children:e})}e.s(["RequestsProvider",()=>o,"useRequests",0,()=>{let e=(0,s.useContext)(a);if(void 0===e)throw Error("useRequests must be used within a RequestsProvider");return e}])},48023,e=>{"use strict";var t=e.i(43476),s=e.i(42711);function r({children:e}){return(0,t.jsx)(s.RequestsProvider,{children:e})}e.s(["default",()=>r])}]);