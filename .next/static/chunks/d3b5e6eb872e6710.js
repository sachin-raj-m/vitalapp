(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,5050,e=>{"use strict";var r=e.i(43476);e.s(["Card",0,({children:e,className:o=""})=>(0,r.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${o}`,children:e}),"CardBody",0,({children:e,className:o=""})=>(0,r.jsx)("div",{className:`px-6 py-4 ${o}`,children:e}),"CardHeader",0,({children:e,className:o=""})=>(0,r.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${o}`,children:e})])},29377,e=>{"use strict";let r=(0,e.i(75254).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>r],29377)},36271,e=>{"use strict";var r=e.i(17927);async function o(e){try{let{data:o,error:a}=await r.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",e).single();if(a)throw console.error("Error fetching profile:",a),a;return!!(o&&o.full_name&&o.blood_group&&o.blood_group_proof_url)}catch(e){return console.error("Error checking registration status:",e),!1}}e.s(["isRegistrationComplete",()=>o])},81928,e=>{"use strict";var r=e.i(43476),o=e.i(71645),a=e.i(18566),t=e.i(5050),l=e.i(1206),i=e.i(78896),s=e.i(76525),n=e.i(17927),p=e.i(29377),u=e.i(97815),d=e.i(36271);function c(){let e=(0,a.useRouter)(),{user:c}=(0,u.useAuth)(),[g,m]=(0,o.useState)(""),[h,f]=(0,o.useState)("loading"),[b,x]=(0,o.useState)(0),[y,v]=(0,o.useState)(null),[j,N]=(0,o.useState)({fullName:"",phone:"",bloodGroup:"",proofType:"",proofFile:null,permanentZip:"",presentZip:""}),[C,_]=(0,o.useState)({});(0,o.useEffect)(()=>{let r=async()=>{console.log("Initializing CompleteRegistration page");try{if(!c){console.log("No user found, redirecting to login"),e.push("/login");return}console.log("Current user:",c);let r=await (0,d.isRegistrationComplete)(c.id);if(console.log("Registration status:",r),r){console.log("Registration already complete, redirecting to dashboard"),e.push("/dashboard");return}let o=localStorage.getItem("pendingRegistration");if(console.log("Stored registration data:",o),!o){console.log("No pending registration data found"),m("Registration data not found. Please register again."),e.push("/register");return}try{let e=JSON.parse(o);if(console.log("Parsed registration data:",e),e.userId!==c.id)throw console.log("User ID mismatch:",{stored:e.userId,current:c.id}),Error("User ID mismatch");v(e),e.phone&&N(r=>({...r,phone:e.phone})),f("form")}catch(e){throw console.error("Error processing stored data:",e),Error("Invalid registration data")}}catch(r){console.error("Initialization error:",r),m(r.message||"Failed to load registration data"),e.push("/register")}};void 0!==c&&r()},[e,c]);let w=async r=>{let o;if(r.preventDefault(),o={},j.fullName.trim()||(o.fullName="Full name is required"),j.phone.trim()||(o.phone="Phone number is required"),j.bloodGroup||(o.bloodGroup="Blood group is required"),j.proofType||(o.proofType="Please select proof type"),j.proofFile?j.proofFile.size>1048576&&(o.proofFile="File size must be less than 1MB"):o.proofFile="Please upload proof document",j.permanentZip.trim()||(o.permanentZip="Permanent Zip Code is required"),j.presentZip.trim()||(o.presentZip="Present Zip Code is required"),_(o),0===Object.keys(o).length&&y){f("uploading"),x(25);try{let{data:{session:r},error:o}=await n.supabase.auth.getSession();if(o)throw o;if(!r){m("Authentication required. Please sign in again."),e.push("/login");return}if(r.user.id!==y.userId){m("Session mismatch. Please register again."),e.push("/register");return}let a=`${r.user.id}/${Date.now()}-${j.proofFile.name}`,{error:t}=await n.supabase.storage.from("proofs").upload(a,j.proofFile,{upsert:!1,contentType:j.proofFile.type});if(t)throw t;x(50),f("creating_profile");let{error:l}=await n.supabase.from("profiles").upsert({id:r.user.id,email:y.email,full_name:j.fullName,phone:j.phone,blood_group:j.bloodGroup,blood_group_proof_type:j.proofType,blood_group_proof_url:a,is_donor:!0,is_available:!0,permanent_zip:j.permanentZip,present_zip:j.presentZip,location:{latitude:0,longitude:0,address:""}},{onConflict:"id",ignoreDuplicates:!1});if(l)throw l;x(75),f("finalizing");let{error:i}=await n.supabase.auth.updateUser({data:{registration_completed:!0,phone:j.phone}});if(i)throw i;x(100),f("completed"),localStorage.removeItem("pendingRegistration"),setTimeout(()=>e.push("/dashboard"),1500)}catch(e){console.error("Registration completion error:",e),m(e.message||"Failed to complete registration"),f("error")}}},F=e=>{let r=e.target.files?.[0];r&&(r.size>1048576?_(e=>({...e,proofFile:"File size must be less than 1MB"})):(_(e=>{let r={...e};return delete r.proofFile,r}),N(e=>({...e,proofFile:r}))))};return(0,r.jsx)("div",{className:"max-w-md mx-auto",children:(0,r.jsx)(t.Card,{children:(0,r.jsx)(t.CardBody,{className:"text-center py-8",children:(()=>{switch(h){case"loading":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Loading Registration Data"}),(0,r.jsx)(p.Loader2,{className:"h-8 w-8 animate-spin text-primary-500"})]});case"form":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Complete Your Registration"}),g&&(0,r.jsx)(i.Alert,{variant:"error",className:"mb-4",children:g}),(0,r.jsxs)("form",{onSubmit:w,className:"space-y-4",children:[(0,r.jsx)(l.Input,{label:"Full Name",value:j.fullName,onChange:e=>N({...j,fullName:e.target.value}),required:!0,autoComplete:"name",placeholder:"Enter your full name",error:C.fullName}),(0,r.jsx)(l.Input,{label:"Phone Number",type:"tel",value:j.phone,onChange:e=>N({...j,phone:e.target.value}),required:!0,autoComplete:"tel",placeholder:"Enter your phone number",error:C.phone}),(0,r.jsx)(l.Select,{label:"Blood Group",value:j.bloodGroup,onChange:e=>N({...j,bloodGroup:e.target.value}),options:[{value:"",label:"Select Blood Group"},{value:"A+",label:"A+"},{value:"A-",label:"A-"},{value:"B+",label:"B+"},{value:"B-",label:"B-"},{value:"AB+",label:"AB+"},{value:"AB-",label:"AB-"},{value:"O+",label:"O+"},{value:"O+",label:"O+"},{value:"O-",label:"O-"}],required:!0,error:C.bloodGroup}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsx)(l.Input,{label:"Permanent Zip Code",value:j.permanentZip,onChange:e=>N({...j,permanentZip:e.target.value}),required:!0,placeholder:"e.g. 560001",error:C.permanentZip}),(0,r.jsx)(l.Input,{label:"Present Zip Code",value:j.presentZip,onChange:e=>N({...j,presentZip:e.target.value}),required:!0,placeholder:"e.g. 560001",error:C.presentZip})]}),(0,r.jsx)(l.Select,{label:"Blood Group Proof Type",value:j.proofType,onChange:e=>N({...j,proofType:e.target.value}),options:[{value:"",label:"Select Proof Type"},{value:"medical_certificate",label:"Medical Certificate"},{value:"hospital_report",label:"Hospital Report"},{value:"blood_donation_card",label:"Blood Donation Card"},{value:"lab_report",label:"Laboratory Report"}],required:!0,error:C.proofType}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Proof"}),(0,r.jsx)(l.Input,{type:"file",onChange:F,accept:".pdf,.jpg,.jpeg,.png",required:!0,className:"w-full",error:C.proofFile}),(0,r.jsx)("p",{className:"text-xs text-gray-500",children:"Accepted formats: PDF, JPG, JPEG, PNG (Max size: 1MB)"})]}),(0,r.jsx)(s.Button,{type:"submit",variant:"primary",className:"w-full",children:"Complete Registration"})]})]});case"uploading":case"creating_profile":case"finalizing":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Completing Registration"}),(0,r.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-4",children:(0,r.jsx)("div",{className:"bg-primary-500 h-2.5 rounded-full transition-all duration-500",style:{width:`${b}%`}})}),(0,r.jsxs)("p",{className:"text-gray-600",children:["uploading"===h&&"Uploading your documents...","creating_profile"===h&&"Creating your profile...","finalizing"===h&&"Finalizing your registration..."]})]});case"completed":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-green-600 mb-4",children:"Registration Complete!"}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:"Your account has been successfully set up."}),(0,r.jsx)("p",{className:"text-gray-600",children:"Redirecting you to the dashboard..."})]});case"error":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-4",children:"Registration Error"}),(0,r.jsx)(i.Alert,{variant:"error",className:"mb-4",children:g}),(0,r.jsx)(s.Button,{variant:"primary",onClick:()=>e.push("/register"),className:"w-full",children:"Try Again"})]})}})()})})})}e.s(["default",()=>c])}]);