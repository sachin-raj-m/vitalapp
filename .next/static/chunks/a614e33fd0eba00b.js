(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78896,98791,e=>{"use strict";var t=e.i(43476);let l=(0,e.i(75254).default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);e.s(["AlertCircle",()=>l],98791);var r=e.i(5631),s=e.i(52571),a=e.i(37727);e.s(["Alert",0,({title:e,children:n,variant:o="info",onClose:i,className:c=""})=>{let d={info:(0,t.jsx)(s.Info,{className:"h-5 w-5 text-blue-400"}),success:(0,t.jsx)(r.CheckCircle,{className:"h-5 w-5 text-green-400"}),warning:(0,t.jsx)(l,{className:"h-5 w-5 text-yellow-400"}),error:(0,t.jsx)(l,{className:"h-5 w-5 text-red-400"})},u=`
    rounded-md p-4
    ${{info:"bg-blue-50 text-blue-800",success:"bg-green-50 text-green-800",warning:"bg-yellow-50 text-yellow-800",error:"bg-red-50 text-red-800"}[o]}
    ${c}
  `;return(0,t.jsx)("div",{className:u,children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:d[o]}),(0,t.jsxs)("div",{className:"ml-3 flex-1",children:[e&&(0,t.jsx)("h3",{className:"text-sm font-medium",children:e}),(0,t.jsx)("div",{className:`text-sm ${e?"mt-2":""}`,children:n})]}),i&&(0,t.jsx)("div",{className:"ml-auto pl-3",children:(0,t.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,t.jsxs)("button",{type:"button",onClick:i,className:`
                  inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2
                  ${"info"===o?"text-blue-500 hover:bg-blue-100 focus:ring-blue-600":""}
                  ${"success"===o?"text-green-500 hover:bg-green-100 focus:ring-green-600":""}
                  ${"warning"===o?"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600":""}
                  ${"error"===o?"text-red-500 hover:bg-red-100 focus:ring-red-600":""}
                `,children:[(0,t.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,t.jsx)(a.X,{className:"h-5 w-5"})]})})})]})})}],78896)},46897,e=>{"use strict";let t=(0,e.i(75254).default)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);e.s(["MapPin",()=>t],46897)},67585,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"BailoutToCSR",{enumerable:!0,get:function(){return s}});let r=e.r(32061);function s({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new r.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},9885,(e,t,l)=>{"use strict";function r(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"encodeURIPath",{enumerable:!0,get:function(){return r}})},52157,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"PreloadChunks",{enumerable:!0,get:function(){return o}});let r=e.r(43476),s=e.r(74080),a=e.r(63599),n=e.r(9885);function o({moduleIds:e}){if("undefined"!=typeof window)return null;let t=a.workAsyncStorage.getStore();if(void 0===t)return null;let l=[];if(t.reactLoadableManifest&&e){let r=t.reactLoadableManifest;for(let t of e){if(!r[t])continue;let e=r[t].files;l.push(...e)}}return 0===l.length?null:(0,r.jsx)(r.Fragment,{children:l.map(e=>{let l=`${t.assetPrefix}/_next/${(0,n.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,r.jsx)("link",{precedence:"dynamic",href:l,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,s.preload)(l,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},69093,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return c}});let r=e.r(43476),s=e.r(71645),a=e.r(67585),n=e.r(52157);function o(e){return{default:e&&"default"in e?e.default:e}}let i={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...i,...e},l=(0,s.lazy)(()=>t.loader().then(o)),c=t.loading;function d(e){let o=c?(0,r.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,i=!t.ssr||!!t.loading,d=i?s.Suspense:s.Fragment,u=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(n.PreloadChunks,{moduleIds:t.modules}):null,(0,r.jsx)(l,{...e})]}):(0,r.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(l,{...e})});return(0,r.jsx)(d,{...i?{fallback:o}:{},children:u})}return d.displayName="LoadableComponent",d}},70703,(e,t,l)=>{"use strict";Object.defineProperty(l,"__esModule",{value:!0}),Object.defineProperty(l,"default",{enumerable:!0,get:function(){return s}});let r=e.r(55682)._(e.r(69093));function s(e,t){let l={};"function"==typeof e&&(l.loader=e);let s={...l,...t};return(0,r.default)({...s,modules:s.loadableGenerated?.modules})}("function"==typeof l.default||"object"==typeof l.default&&null!==l.default)&&void 0===l.default.__esModule&&(Object.defineProperty(l.default,"__esModule",{value:!0}),Object.assign(l.default,l),t.exports=l.default)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);e.s(["Search",()=>t],55436)},73416,e=>{"use strict";var t=e.i(43476),l=e.i(71645),r=e.i(70703),s=e.i(17927),a=e.i(76525),n=e.i(46897);let o=(0,e.i(75254).default)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var i=e.i(55436),c=e.i(78896),d=e.i(97815);let u=(0,r.default)(()=>e.A(9585),{loadableGenerated:{modules:[5481]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-full w-full bg-gray-100 animate-pulse rounded-xl flex items-center justify-center text-gray-400",children:"Loading Map..."})});function f(){let{user:e}=(0,d.useAuth)(),[r,f]=(0,l.useState)({lat:20.5937,lng:78.9629}),[m,x]=(0,l.useState)([]),[g,p]=(0,l.useState)([]),[h,y]=(0,l.useState)(!0),[b,j]=(0,l.useState)(""),[v,w]=(0,l.useState)(""),[N,_]=(0,l.useState)({});(0,l.useEffect)(()=>{(async()=>{try{let{data:e,error:t}=await s.supabase.from("profiles").select("id, full_name, blood_group, location, present_zip").eq("is_donor",!0);if(t)throw t;let l=e?.map(e=>({...e,location:"string"==typeof e.location?JSON.parse(e.location):e.location}))||[],r=new Set;l.forEach(e=>{(!e.location?.latitude||0===e.location.latitude)&&e.present_zip&&r.add(e.present_zip)});let a={...N},n=!1;for(let e of Array.from(r).slice(0,5))if(!a[e])try{let t=await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${e}&country=India&format=json&limit=1`,{headers:{"User-Agent":"VitalBloodApp/1.0"}}),l=await t.json();l&&l.length>0&&(a[e]={lat:parseFloat(l[0].lat),lng:parseFloat(l[0].lon)},n=!0,await new Promise(e=>setTimeout(e,800)))}catch(t){console.error(`Failed to geocode zip ${e}`,t)}n&&_(a);let o=l.map(e=>(!e.location?.latitude||0===e.location.latitude)&&e.present_zip&&a[e.present_zip]?{...e,location:{...e.location,latitude:a[e.present_zip].lat,longitude:a[e.present_zip].lng,address:e.location?.address||`Zip: ${e.present_zip}`}}:e);x(o)}catch(e){console.error("Error fetching donors",e),j(e.message)}finally{y(!1)}})()},[]);let k=(0,l.useCallback)(()=>{if(w("Locating..."),!("geolocation"in navigator)){j("Geolocation not supported by your browser."),w("");return}navigator.geolocation.getCurrentPosition(e=>{f({lat:e.coords.latitude,lng:e.coords.longitude}),w("")},e=>{j("Unable to get your location: "+e.message),w("")},{enableHighAccuracy:!0,timeout:1e4})},[]);return(0,l.useEffect)(()=>{p(m.filter(t=>t.id!==e?.id&&t.location&&void 0!==t.location.latitude&&null!==t.location.latitude&&void 0!==t.location.longitude&&null!==t.location.longitude).map(e=>{var t,l,s,a;let n,o,i,c,d=(t=r.lat,l=r.lng,s=e.location.latitude,a=e.location.longitude,o=(n=e=>e*Math.PI/180)(s-t),i=n(a-l),2*Math.atan2(Math.sqrt(c=Math.sin(o/2)**2+Math.cos(n(t))*Math.cos(n(s))*Math.sin(i/2)**2),Math.sqrt(1-c))*6371);return{...e,distanceKm:d}}).sort((e,t)=>(e.distanceKm||0)-(t.distanceKm||0)).slice(0,20))},[r,m,e]),(0,t.jsxs)("div",{className:"space-y-6 h-[calc(100vh-140px)] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Find Donors Nearby"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"Discover life-savers in your vicinity"})]}),(0,t.jsx)(a.Button,{onClick:k,leftIcon:v?(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):(0,t.jsx)(o,{className:"h-4 w-4"}),disabled:!!v,className:"shadow-sm transition-all hover:shadow-md active:scale-95",children:v||"Use My Location"})]}),b&&(0,t.jsx)(c.Alert,{variant:"error",className:"flex-shrink-0",children:b}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow min-h-0",children:[(0,t.jsx)("div",{className:"lg:col-span-8 h-[400px] lg:h-full rounded-2xl overflow-hidden border border-gray-200 shadow-sm relative group bg-gray-50",children:(0,t.jsx)(u,{center:r,zoom:11,markers:[{position:r,title:"You are here"},...g.map(e=>({position:{lat:e.location.latitude,lng:e.location.longitude},title:e.full_name,description:`${e.blood_group} | ${e.distanceKm?.toFixed(1)} km away`}))]})}),(0,t.jsxs)("div",{className:"lg:col-span-4 flex flex-col h-full min-h-0 bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[(0,t.jsxs)("h2",{className:"font-semibold text-gray-800 flex items-center",children:[(0,t.jsx)(i.Search,{className:"w-4 h-4 mr-2 text-gray-400"}),"Closest Donors"]}),(0,t.jsxs)("span",{className:"bg-white text-gray-600 px-2 py-0.5 rounded-full text-xs font-medium border border-gray-200",children:[g.length," found"]})]}),(0,t.jsx)("div",{className:"overflow-y-auto p-4 space-y-3 custom-scrollbar flex-grow",children:0===g.length?(0,t.jsxs)("div",{className:"text-center py-12 flex flex-col items-center justify-center opacity-60",children:[(0,t.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-3",children:(0,t.jsx)(n.MapPin,{className:"h-8 w-8 text-gray-400"})}),(0,t.jsx)("p",{className:"text-gray-900 font-medium",children:"No donors found nearby"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1 max-w-[200px]",children:"Try using your current location or expanding your search area."})]}):g.map(e=>(0,t.jsxs)("div",{onClick:()=>f({lat:e.location.latitude,lng:e.location.longitude}),className:"group flex items-center p-3 rounded-xl border border-gray-100 hover:border-primary-100 hover:bg-primary-50/30 transition-all duration-200 cursor-pointer",children:[(0,t.jsx)("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-500 font-bold text-lg shadow-inner flex-shrink-0",children:e.full_name.split(" ").map(e=>e[0]).slice(0,2).join("").toUpperCase()}),(0,t.jsxs)("div",{className:"ml-3 flex-grow min-w-0",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 truncate pr-2",children:e.full_name}),(0,t.jsx)("span",{className:`text-xs font-bold px-2 py-0.5 rounded border ${e.blood_group.includes("+")?"bg-rose-100 text-rose-700 border-rose-200":"bg-indigo-100 text-indigo-700 border-indigo-200"}`,children:e.blood_group})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,t.jsx)("div",{className:"flex items-center text-xs text-gray-500",children:e.present_zip?(0,t.jsx)("span",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 font-mono",children:e.present_zip}):(0,t.jsx)("span",{className:"text-gray-400 italic",children:"Zip N/A"})}),(0,t.jsxs)("div",{className:"text-xs font-medium text-gray-500 flex items-center",children:[(0,t.jsx)(n.MapPin,{className:"w-3 h-3 mr-1 text-gray-400"}),e.distanceKm?.toFixed(1)," km"]})]})]})]},e.id))})]})]})]})}e.s(["default",()=>f],73416)},9585,e=>{e.v(t=>Promise.all(["static/chunks/81308917bb7a5a99.js","static/chunks/076efda0d0cae75b.css"].map(t=>e.l(t))).then(()=>t(5481)))}]);