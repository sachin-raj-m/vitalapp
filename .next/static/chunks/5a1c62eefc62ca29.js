(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,29377,e=>{"use strict";let t=(0,e.i(75254).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],29377)},18566,(e,t,r)=>{t.exports=e.r(76562)},5050,e=>{"use strict";var t=e.i(43476);e.s(["Card",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${r}`,children:e}),"CardBody",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`px-6 py-4 ${r}`,children:e}),"CardHeader",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${r}`,children:e})])},37727,e=>{"use strict";let t=(0,e.i(75254).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},36271,e=>{"use strict";var t=e.i(17927);async function r(e){try{console.log("Checking registration completion for user:",e);let{data:r,error:s}=await t.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",e).single();if(s)throw console.error("Error fetching profile:",s),s;console.log("Profile data:",r);let i=!!(r&&r.full_name&&r.blood_group&&r.blood_group_proof_url);return console.log("Registration complete?",i),i}catch(e){return console.error("Error checking registration status:",e),!1}}e.s(["isRegistrationComplete",()=>r])},43432,e=>{"use strict";let t=(0,e.i(75254).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);e.s(["Phone",()=>t],43432)},63488,e=>{"use strict";let t=(0,e.i(75254).default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);e.s(["Mail",()=>t],63488)},3578,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(97815),i=e.i(18566);function o({children:e}){let{user:o,session:l,loading:a,error:n,refreshProfile:c}=(0,s.useAuth)(),d=(0,i.useRouter)(),u=(0,i.usePathname)(),[m,h]=(0,r.useState)(0);return((0,r.useEffect)(()=>{console.log("ProtectedRoute state:",{user:o,loading:a,session:l})},[o,a,l]),(0,r.useEffect)(()=>{l?.user?.id&&!o&&!a&&m<3&&(console.log(`Profile missing despite active session, refreshing (attempt ${m+1})`),c(),h(e=>e+1))},[l,o,a,c,m]),a)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your dashboard."})]})}):((0,r.useEffect)(()=>{o&&l||a&&!(m>=3)||d.push(`/login?from=${u}`)},[o,l,a,m,d,u]),o&&l||a&&!(m>=3))?(console.log("ProtectedRoute: Rendering protected content"),(0,t.jsx)(t.Fragment,{children:e})):null}var l=e.i(36271),a=e.i(5050),n=e.i(29377);function c({children:e}){let o=(0,i.useRouter)(),{user:c}=(0,s.useAuth)(),[d,u]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{if(console.log("RegistrationGuard: Checking registration status"),!c){console.log("RegistrationGuard: No user found, redirecting to login"),o.push("/login");return}try{console.log("RegistrationGuard: Checking completion for user:",c.id);let e=await (0,l.isRegistrationComplete)(c.id);if(console.log("RegistrationGuard: Registration complete?",e),e)console.log("RegistrationGuard: Registration complete, allowing access"),u(!1);else{console.log("RegistrationGuard: Registration incomplete, redirecting to complete registration");let e={userId:c.id,email:c.email,phone:c.phone||""};console.log("RegistrationGuard: Storing pending data:",e),localStorage.setItem("pendingRegistration",JSON.stringify(e)),o.push("/complete-registration")}}catch(t){console.error("RegistrationGuard: Error checking registration:",t);let e={userId:c.id,email:c.email,phone:c.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(e)),o.push("/complete-registration")}})()},[c,o]),d)?(0,t.jsx)("div",{className:"max-w-md mx-auto",children:(0,t.jsx)(a.Card,{children:(0,t.jsxs)(a.CardBody,{className:"text-center py-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Checking Profile"}),(0,t.jsx)(n.Loader2,{className:"h-8 w-8 animate-spin text-primary-500 mx-auto"})]})})}):(0,t.jsx)(t.Fragment,{children:e})}var d=e.i(76525),u=e.i(17927),m=e.i(63488),h=e.i(43432),g=e.i(37727);let f=()=>{let{session:e,user:i}=(0,s.useAuth)(),[o,l]=(0,r.useState)(!0),[a,n]=(0,r.useState)(null),[c,f]=(0,r.useState)(null),[x,p]=(0,r.useState)("");if(!e?.user||!o)return null;let y=e.user.email_confirmed_at,w=e.user.phone_confirmed_at;if(y&&(w||!i?.phone))return null;let b=(i?.phone||e.user.phone)&&!w;if(!b&&y)return null;let j=async()=>{n("email"),p("");try{let{error:t}=await u.supabase.auth.resend({type:"signup",email:e.user.email,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(t)throw t;f("email")}catch(e){console.error("Error sending verification email:",e),p(e.message||"Failed to send verification email")}finally{n(null)}},v=async()=>{window.location.href="/profile"};return(0,t.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200 p-4 relative",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsxs)("h3",{className:"text-sm font-medium text-yellow-800 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-yellow-200 text-yellow-700 text-xs font-bold",children:"!"}),"Account Verification"]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-yellow-700",children:!y&&b?"Please verify your email and phone number to secure your account.":y?"Please verify your phone number to secure your account.":"Please verify your email address to secure your account."}),x&&(0,t.jsx)("p",{className:"mt-1 text-xs text-red-600",children:x}),"email"===c&&(0,t.jsx)("p",{className:"mt-1 text-xs text-green-600",children:"Verification email sent!"})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2",children:[!y&&"email"!==c&&(0,t.jsx)(d.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:j,isLoading:"email"===a,leftIcon:(0,t.jsx)(m.Mail,{className:"h-3 w-3"}),children:"Verify Email"}),b&&(0,t.jsx)(d.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:v,leftIcon:(0,t.jsx)(h.Phone,{className:"h-3 w-3"}),children:"Verify Phone"}),(0,t.jsx)("button",{onClick:()=>l(!1),className:"text-yellow-500 hover:text-yellow-700 p-1","aria-label":"Dismiss",children:(0,t.jsx)(g.X,{className:"h-5 w-5"})})]})]})})};function x({children:e}){return(0,t.jsx)(o,{children:(0,t.jsx)(c,{children:(0,t.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,t.jsx)(f,{}),e]})})})}e.s(["default",()=>x],3578)}]);