(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,29377,e=>{"use strict";let t=(0,e.i(75254).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],29377)},5050,e=>{"use strict";var t=e.i(43476);e.s(["Card",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${r}`,children:e}),"CardBody",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`px-6 py-4 ${r}`,children:e}),"CardHeader",0,({children:e,className:r=""})=>(0,t.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${r}`,children:e})])},18566,(e,t,r)=>{t.exports=e.r(76562)},36271,e=>{"use strict";var t=e.i(17927);async function r(e){try{console.log("Checking registration completion for user:",e);let{data:r,error:o}=await t.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",e).single();if(o)throw console.error("Error fetching profile:",o),o;console.log("Profile data:",r);let i=!!(r&&r.full_name&&r.blood_group&&r.blood_group_proof_url);return console.log("Registration complete?",i),i}catch(e){return console.error("Error checking registration status:",e),!1}}e.s(["isRegistrationComplete",()=>r])},3578,e=>{"use strict";var t=e.i(43476),r=e.i(71645),o=e.i(97815),i=e.i(18566);function s({children:e}){let{user:s,session:n,loading:a,error:l,refreshProfile:c}=(0,o.useAuth)(),d=(0,i.useRouter)(),g=(0,i.usePathname)(),[u,m]=(0,r.useState)(0);return((0,r.useEffect)(()=>{console.log("ProtectedRoute state:",{user:s,loading:a,session:n})},[s,a,n]),(0,r.useEffect)(()=>{n?.user?.id&&!s&&!a&&u<3&&(console.log(`Profile missing despite active session, refreshing (attempt ${u+1})`),c(),m(e=>e+1))},[n,s,a,c,u]),a)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,t.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your dashboard."})]})}):((0,r.useEffect)(()=>{s&&n||a&&!(u>=3)||d.push(`/login?from=${g}`)},[s,n,a,u,d,g]),s&&n||a&&!(u>=3))?(console.log("ProtectedRoute: Rendering protected content"),(0,t.jsx)(t.Fragment,{children:e})):null}var n=e.i(36271),a=e.i(5050),l=e.i(29377);function c({children:e}){let s=(0,i.useRouter)(),{user:c}=(0,o.useAuth)(),[d,g]=(0,r.useState)(!0);return((0,r.useEffect)(()=>{(async()=>{if(console.log("RegistrationGuard: Checking registration status"),!c){console.log("RegistrationGuard: No user found, redirecting to login"),s.push("/login");return}try{console.log("RegistrationGuard: Checking completion for user:",c.id);let e=await (0,n.isRegistrationComplete)(c.id);if(console.log("RegistrationGuard: Registration complete?",e),e)console.log("RegistrationGuard: Registration complete, allowing access"),g(!1);else{console.log("RegistrationGuard: Registration incomplete, redirecting to complete registration");let e={userId:c.id,email:c.email,phone:c.phone||""};console.log("RegistrationGuard: Storing pending data:",e),localStorage.setItem("pendingRegistration",JSON.stringify(e)),s.push("/complete-registration")}}catch(t){console.error("RegistrationGuard: Error checking registration:",t);let e={userId:c.id,email:c.email,phone:c.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(e)),s.push("/complete-registration")}})()},[c,s]),d)?(0,t.jsx)("div",{className:"max-w-md mx-auto",children:(0,t.jsx)(a.Card,{children:(0,t.jsxs)(a.CardBody,{className:"text-center py-8",children:[(0,t.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Checking Profile"}),(0,t.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-primary-500 mx-auto"})]})})}):(0,t.jsx)(t.Fragment,{children:e})}function d({children:e}){return(0,t.jsx)(s,{children:(0,t.jsx)(c,{children:e})})}e.s(["default",()=>d],3578)}]);