module.exports=[33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},34904,a=>{"use strict";var b=a.i(87924);a.s(["Card",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${c}`,children:a}),"CardBody",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 ${c}`,children:a}),"CardHeader",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${c}`,children:a})])},26017,a=>{"use strict";let b=(0,a.i(70106).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],26017)},41710,a=>{"use strict";let b=(0,a.i(70106).default)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);a.s(["Clock",()=>b],41710)},92994,a=>{"use strict";var b=a.i(87924),c=a.i(12466);a.s(["EmptyState",0,({icon:a,title:d,description:e,actionLabel:f,onAction:g,className:h})=>(0,b.jsxs)("div",{className:`flex flex-col items-center justify-center py-12 px-4 text-center bg-white rounded-lg border border-gray-100 shadow-sm ${h||""}`,children:[(0,b.jsx)("div",{className:"bg-primary-50 p-4 rounded-full mb-4",children:(0,b.jsx)(a,{className:"h-8 w-8 text-primary-500"})}),(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:d}),(0,b.jsx)("p",{className:"text-gray-500 text-sm max-w-sm mb-6 leading-relaxed",children:e}),f&&g&&(0,b.jsx)(c.Button,{onClick:g,variant:"primary",children:f})]})])},88736,a=>{"use strict";var b=a.i(87924),c=a.i(33508);a.s(["Modal",0,({isOpen:a,onClose:d,title:e,children:f})=>a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,b.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center sm:p-0",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),(0,b.jsx)("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:(0,b.jsxs)("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-medium leading-6 text-gray-900",id:"modal-title",children:e}),(0,b.jsxs)("button",{type:"button",className:"ml-4 inline-flex flex-shrink-0 items-center justify-center rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",onClick:d,children:[(0,b.jsx)("span",{className:"sr-only",children:"Close"}),(0,b.jsx)(c.X,{className:"h-5 w-5","aria-hidden":"true"})]})]}),(0,b.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:f})]})})]})}):null])},60484,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(34904),e=a.i(34048),f=a.i(12466),g=a.i(18180),h=a.i(88736),i=a.i(24452),j=a.i(53131),k=a.i(78560),l=a.i(26017),m=a.i(95756),n=a.i(41710),o=a.i(92994);function p(){let{user:a}=(0,j.useAuth)(),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)("active"),x=p.filter(a=>"active"===v?"active"===a.status:"fulfilled"===a.status||"cancelled"===a.status),[y,z]=(0,c.useState)({isOpen:!1,donationId:"",requestId:"",donorName:"",maxUnits:0}),[A,B]=(0,c.useState)(""),[C,D]=(0,c.useState)(1),[E,F]=(0,c.useState)(!1),[G,H]=(0,c.useState)("");(0,c.useEffect)(()=>{I()},[a]);let I=async()=>{if(a)try{let{data:b,error:c}=await k.supabase.from("blood_requests").select(`
                    *,
                    donations:donations(
                        *,
                        profiles(full_name, phone)
                    )
                `).eq("user_id",a.id).order("created_at",{ascending:!1});if(c)throw c;q(b)}catch(a){console.error("Error fetching requests"),u("Failed to load your requests")}finally{s(!1)}},J=async()=>{F(!0),H("");try{let{data:a,error:b}=await k.supabase.from("donations").select("otp, request_id").eq("id",y.donationId).single();if(b)throw console.error("OTP Check Error:",b),b;if(a.otp===A){let{error:a,count:b}=await k.supabase.from("donations").update({status:"completed",units_donated:C},{count:"exact"}).eq("id",y.donationId);if(a)throw console.error("Donation Update Error:",a),alert(`Update Failed: ${a.message}
Details: ${a.details||"N/A"}`),a;if(0===b){let a="Permission Error: The system blocked the update. You might not have permission to verify this donation.";throw console.error(a),alert(a),Error(a)}let{data:c,error:d}=await k.supabase.from("donations").select("units_donated").eq("request_id",y.requestId).eq("status","completed");if(d)throw console.error("Sum Calculation Error:",d),d;let e=c.reduce((a,b)=>a+(b.units_donated||0),0),f=p.find(a=>a.id===y.requestId),g=f?.units_needed||0,h="Donation verified successfully!";if(e>=g){let{error:a}=await k.supabase.from("blood_requests").update({status:"fulfilled"}).eq("id",y.requestId);if(a)throw console.error("Request Fulfillment Error:",a),alert("Warning: Donation verified but failed to close request automatically."),a;h+=" Request has been fulfilled and closed."}else h+=` Progress: ${e}/${g} units.`;await I(),z({isOpen:!1,donationId:"",requestId:"",donorName:"",maxUnits:0}),B(""),D(1),setTimeout(()=>alert(h),100)}else H("Invalid PIN. Please ask the donor for their correct PIN.")}catch(a){console.error("Verification error",a),H(a.message||"Verification failed"),alert(`Verification Error: ${a.message}`)}finally{F(!1)}};return r?(0,b.jsx)("div",{className:"flex justify-center items-center min-h-[60vh]",children:(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-primary-500"})}):(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Requests"}),t&&(0,b.jsx)(i.Alert,{variant:"error",children:t}),(0,b.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit",children:[(0,b.jsx)("button",{onClick:()=>w("active"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"active"===v?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Active Requests"}),(0,b.jsx)("button",{onClick:()=>w("past"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"past"===v?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Past Requests"})]}),0===x.length?(0,b.jsx)(o.EmptyState,{icon:n.Clock,title:"active"===v?"No Active Requests":"No Past Requests",description:"active"===v?"You don't have any active blood requests. If you or a loved one needs help, create a request now.":"You haven't made any requests in the past.",actionLabel:"active"===v?"Create Request":void 0,onAction:"active"===v?()=>window.location.href="/requests/new":void 0}):(0,b.jsx)("div",{className:"space-y-6",children:x.map(a=>{let c=a.donations.filter(a=>"completed"===a.status).reduce((a,b)=>a+(b.units_donated||1),0),g="active"!==a.status;return(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start gap-2",children:[(0,b.jsxs)("div",{className:"flex-grow",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:[a.blood_group," Blood Needed"]}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.hospital_name})]}),g&&(0,b.jsxs)("div",{className:"text-right text-sm text-gray-500 hidden md:block",children:[(0,b.jsxs)("div",{children:["Posted: ",new Date(a.created_at).toLocaleDateString()]}),"fulfilled"===a.status&&(0,b.jsxs)("div",{children:["Fulfilled: ",new Date(a.updated_at).toLocaleDateString()]})]})]}),!g&&(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap gap-4 text-sm bg-gray-50 p-3 rounded-lg border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Units Required"}),(0,b.jsxs)("span",{className:"font-medium text-gray-900",children:[a.units_needed," Units"]})]}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Collected"}),(0,b.jsxs)("span",{className:"font-medium text-success-600",children:[c," Units"]})]}),a.date_needed&&(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Date Needed"}),(0,b.jsx)("span",{className:"font-medium text-gray-900",children:new Date(a.date_needed).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"flex flex-col md:hidden",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Date Posted"}),(0,b.jsx)("span",{className:"font-medium text-gray-900",children:new Date(a.created_at).toLocaleDateString()})]})]}),g&&(0,b.jsxs)("div",{className:"mt-3 flex flex-wrap gap-4 text-sm bg-gray-50 p-3 rounded-lg border border-gray-100",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Units Required"}),(0,b.jsxs)("span",{className:"font-medium text-gray-900",children:[a.units_needed," Units"]})]}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Units Received"}),(0,b.jsxs)("span",{className:"font-medium text-success-600",children:[c," Units"]})]}),a.date_needed&&(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Date Needed"}),(0,b.jsx)("span",{className:"font-medium text-gray-900",children:new Date(a.date_needed).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"flex flex-col md:hidden",children:[(0,b.jsx)("span",{className:"text-gray-500 text-xs uppercase font-semibold",children:"Date Posted"}),(0,b.jsx)("span",{className:"font-medium text-gray-900",children:new Date(a.created_at).toLocaleDateString()})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1 self-end md:self-auto pl-4",children:[(0,b.jsx)(e.Badge,{variant:"active"===a.status?"warning":"fulfilled"===a.status?"success":"neutral",children:a.status.charAt(0).toUpperCase()+a.status.slice(1)}),"active"===a.status&&(0,b.jsxs)("div",{className:"w-32 mt-1",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[(0,b.jsx)("span",{children:"Collected"}),(0,b.jsxs)("span",{children:[c," / ",a.units_needed]})]}),(0,b.jsx)("div",{className:"h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${Math.min(100,c/a.units_needed*100)}%`}})})]})]})]})}),(0,b.jsxs)(d.CardBody,{children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Donation Offers"}),a.donations&&a.donations.length>0?(0,b.jsx)("div",{className:"space-y-3",children:a.donations.map(d=>(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-600 font-bold",children:d.profiles?.full_name?.charAt(0)||"D"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:d.profiles?.full_name||"Anonymous"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"active"===a.status?d.profiles?.phone:(0,b.jsx)("span",{className:"text-gray-400 italic",children:"Contact Hidden"})})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:"pending"===d.status?(0,b.jsx)(f.Button,{size:"sm",onClick:()=>z({isOpen:!0,donationId:d.id,requestId:a.id,donorName:d.profiles?.full_name,maxUnits:a.units_needed-c}),children:"Verify PIN"}):"completed"===d.status?(0,b.jsxs)("span",{className:"flex items-center text-green-600 text-sm font-medium",children:[(0,b.jsx)(m.CheckCircle,{className:"h-4 w-4 mr-1"})," ",d.units_donated||1," Unit(s) Verified"]}):(0,b.jsx)(e.Badge,{variant:"neutral",children:"cancelled"===d.status?"Withdrawn":d.status})})]},d.id))}):(0,b.jsx)("p",{className:"text-gray-500 text-sm italic",children:"No offers yet."})]})]},a.id)})}),(0,b.jsx)(h.Modal,{isOpen:y.isOpen,onClose:()=>z({...y,isOpen:!1}),title:`Verify Donation from ${y.donorName}`,children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Ask the donor for their ",(0,b.jsx)("strong",{children:"4-digit Donor PIN"})," and enter it below to confirm the donation.",(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-xs text-orange-600 font-medium mt-1 block",children:"Note: verifying this will mark the request as fulfilled."})]}),(0,b.jsx)(g.Input,{label:"Enter Donor PIN",placeholder:"e.g. 1234",value:A,onChange:a=>B(a.target.value),maxLength:4,className:"text-center text-2xl tracking-widest"}),(0,b.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Units Donated"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{className:"w-10 h-10 rounded-md bg-white border border-blue-200 text-blue-600 font-bold hover:bg-blue-100",onClick:()=>D(Math.max(1,C-1)),children:"-"}),(0,b.jsx)("span",{className:"text-xl font-bold text-gray-800 w-8 text-center",children:C}),(0,b.jsx)("button",{className:"w-10 h-10 rounded-md bg-white border border-blue-200 text-blue-600 font-bold hover:bg-blue-100",onClick:()=>D(C+1),children:"+"})]}),(0,b.jsx)("p",{className:"text-xs text-blue-600 mt-2",children:"Confirm the number of blood units collected from this donor."})]}),G&&(0,b.jsx)("p",{className:"text-red-500 text-sm",children:G}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,b.jsx)(f.Button,{variant:"secondary",onClick:()=>z({...y,isOpen:!1}),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:J,isLoading:E,disabled:4!==A.length,children:"Verify & Complete"})]})]})})]})}a.s(["MyRequestsContent",()=>p])}];

//# sourceMappingURL=_5fad6124._.js.map