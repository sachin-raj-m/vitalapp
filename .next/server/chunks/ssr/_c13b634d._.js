module.exports=[34904,a=>{"use strict";var b=a.i(87924);a.s(["Card",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${c}`,children:a}),"CardBody",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 ${c}`,children:a}),"CardHeader",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${c}`,children:a})])},26017,a=>{"use strict";let b=(0,a.i(70106).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],26017)},73922,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(78560),e=a.i(53131);let f=(0,c.createContext)(void 0);function g({children:a}){let{user:g}=(0,e.useAuth)(),[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(new Set),[l,m]=(0,c.useState)(!0),[n,o]=(0,c.useState)(null),p=(0,c.useCallback)(async()=>{try{m(!0),o(null);let{data:a,error:b}=await d.supabase.from("blood_requests").select("*").eq("status","active").order("created_at",{ascending:!1});if(b)throw b;if(i(a||[]),g){let{data:a,error:b}=await d.supabase.from("donations").select("request_id").eq("donor_id",g.id).neq("status","cancelled");!b&&a&&k(new Set(a.map(a=>a.request_id)))}else k(new Set)}catch(a){console.error("Error in RequestsContext:",a),o(a)}finally{m(!1)}},[g]);return(0,c.useEffect)(()=>{p();let a=d.supabase.channel("public_requests").on("postgres_changes",{event:"*",schema:"public",table:"blood_requests"},()=>{console.log("Real-time update: Refreshing requests..."),p()}).subscribe();return()=>{d.supabase.removeChannel(a)}},[p,g]),(0,b.jsx)(f.Provider,{value:{requests:h,myDonations:j,loading:l,error:n,refreshRequests:p},children:a})}a.s(["RequestsProvider",()=>g,"useRequests",0,()=>{let a=(0,c.useContext)(f);if(void 0===a)throw Error("useRequests must be used within a RequestsProvider");return a}])},61730,a=>{"use strict";var b=a.i(78560);async function c(a){try{let{data:c,error:d}=await b.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",a).single();if(d)throw console.error("Error fetching profile:",d),d;return!!(c&&c.full_name&&c.blood_group&&c.blood_group_proof_url)}catch(a){return console.error("Error checking registration status:",a),!1}}a.s(["isRegistrationComplete",()=>c])},63519,a=>{"use strict";let b=(0,a.i(70106).default)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);a.s(["Phone",()=>b],63519)},71500,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(53131),e=a.i(50944);function f({children:a}){let{user:f,session:g,loading:h,error:i,refreshProfile:j}=(0,d.useAuth)(),k=(0,e.useRouter)(),l=(0,e.usePathname)(),[m,n]=(0,c.useState)(0);return((0,c.useEffect)(()=>{g?.user?.id&&!f&&!h&&m<3&&(j(),n(a=>a+1))},[g,f,h,j,m]),(0,c.useEffect)(()=>{f&&g||h&&!(m>=3)||k.push(`/login?from=${l}`)},[f,g,h,m,k,l]),h)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Loading..."}),(0,b.jsx)("p",{className:"text-gray-600",children:"Please wait while we prepare your dashboard."})]})}):f&&g||h&&!(m>=3)?(0,b.jsx)(b.Fragment,{children:a}):null}var g=a.i(61730),h=a.i(34904),i=a.i(26017);function j({children:a}){let f=(0,e.useRouter)(),{user:j}=(0,d.useAuth)(),[k,l]=(0,c.useState)(!0);return((0,c.useEffect)(()=>{(async()=>{if(!j)return f.push("/login");try{if(await (0,g.isRegistrationComplete)(j.id))l(!1);else{let a={userId:j.id,email:j.email,phone:j.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(a)),f.push("/complete-registration")}}catch(b){console.error("RegistrationGuard: Error checking registration:",b);let a={userId:j.id,email:j.email,phone:j.phone||""};localStorage.setItem("pendingRegistration",JSON.stringify(a)),f.push("/complete-registration")}})()},[j,f]),k)?(0,b.jsx)("div",{className:"max-w-md mx-auto",children:(0,b.jsx)(h.Card,{children:(0,b.jsxs)(h.CardBody,{className:"text-center py-8",children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Checking Profile"}),(0,b.jsx)(i.Loader2,{className:"h-8 w-8 animate-spin text-primary-500 mx-auto"})]})})}):(0,b.jsx)(b.Fragment,{children:a})}var k=a.i(12466),l=a.i(78560),m=a.i(92258),n=a.i(63519),o=a.i(33508);let p=()=>{let{session:a,user:e}=(0,d.useAuth)(),[f,g]=(0,c.useState)(!0),[h,i]=(0,c.useState)(null),[j,p]=(0,c.useState)(null),[q,r]=(0,c.useState)("");if(!a?.user||!f)return null;let s=a.user.email_confirmed_at,t=a.user.phone_confirmed_at;if(s&&(t||!e?.phone))return null;let u=(e?.phone||a.user.phone)&&!t;if(!u&&s)return null;let v=async()=>{i("email"),r("");try{let{error:b}=await l.supabase.auth.resend({type:"signup",email:a.user.email,options:{emailRedirectTo:`${window.location.origin}/dashboard`}});if(b)throw b;p("email")}catch(a){console.error("Error sending verification email"),r(a.message||"Failed to send verification email")}finally{i(null)}},w=async()=>{window.location.href="/profile"};return(0,b.jsx)("div",{className:"bg-yellow-50 border-b border-yellow-200 p-4 relative",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("h3",{className:"text-sm font-medium text-yellow-800 flex items-center gap-2",children:[(0,b.jsx)("span",{className:"flex items-center justify-center w-5 h-5 rounded-full bg-yellow-200 text-yellow-700 text-xs font-bold",children:"!"}),"Account Verification"]}),(0,b.jsx)("p",{className:"mt-1 text-sm text-yellow-700",children:!s&&u?"Please verify your email and phone number to secure your account.":s?"Please verify your phone number to secure your account.":"Please verify your email address to secure your account."}),q&&(0,b.jsx)("p",{className:"mt-1 text-xs text-red-600",children:q}),"email"===j&&(0,b.jsx)("p",{className:"mt-1 text-xs text-green-600",children:"Verification email sent!"})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[!s&&"email"!==j&&(0,b.jsx)(k.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:v,isLoading:"email"===h,leftIcon:(0,b.jsx)(m.Mail,{className:"h-3 w-3"}),children:"Verify Email"}),u&&(0,b.jsx)(k.Button,{size:"sm",variant:"outline",className:"bg-white hover:bg-yellow-50 text-yellow-700 border-yellow-300",onClick:w,leftIcon:(0,b.jsx)(n.Phone,{className:"h-3 w-3"}),children:"Verify Phone"}),(0,b.jsx)("button",{onClick:()=>g(!1),className:"text-yellow-500 hover:text-yellow-700 p-1","aria-label":"Dismiss",children:(0,b.jsx)(o.X,{className:"h-5 w-5"})})]})]})})};var q=a.i(73922);function r({children:a}){return(0,b.jsx)(f,{children:(0,b.jsx)(j,{children:(0,b.jsx)(q.RequestsProvider,{children:(0,b.jsxs)("div",{className:"flex flex-col min-h-screen",children:[(0,b.jsx)(p,{}),a]})})})})}a.s(["default",()=>r],71500)}];

//# sourceMappingURL=_c13b634d._.js.map