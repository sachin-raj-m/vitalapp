module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},26017,a=>{"use strict";let b=(0,a.i(70106).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],26017)},41997,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},90821,a=>{"use strict";let b=(0,a.i(70106).default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>b],90821)},34904,a=>{"use strict";var b=a.i(87924);a.s(["Card",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${c}`,children:a}),"CardBody",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 ${c}`,children:a}),"CardHeader",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${c}`,children:a})])},33508,a=>{"use strict";let b=(0,a.i(70106).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["X",()=>b],33508)},24452,a=>{"use strict";var b=a.i(87924),c=a.i(90821),d=a.i(70106);let e=(0,d.default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),f=(0,d.default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var g=a.i(33508);a.s(["Alert",0,({title:a,children:d,variant:h="info",onClose:i,className:j=""})=>{let k={info:(0,b.jsx)(f,{className:"h-5 w-5 text-blue-400"}),success:(0,b.jsx)(e,{className:"h-5 w-5 text-green-400"}),warning:(0,b.jsx)(c.AlertCircle,{className:"h-5 w-5 text-yellow-400"}),error:(0,b.jsx)(c.AlertCircle,{className:"h-5 w-5 text-red-400"})},l=`
    rounded-md p-4
    ${{info:"bg-blue-50 text-blue-800",success:"bg-green-50 text-green-800",warning:"bg-yellow-50 text-yellow-800",error:"bg-red-50 text-red-800"}[h]}
    ${j}
  `;return(0,b.jsx)("div",{className:l,children:(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:k[h]}),(0,b.jsxs)("div",{className:"ml-3 flex-1",children:[a&&(0,b.jsx)("h3",{className:"text-sm font-medium",children:a}),(0,b.jsx)("div",{className:`text-sm ${a?"mt-2":""}`,children:d})]}),i&&(0,b.jsx)("div",{className:"ml-auto pl-3",children:(0,b.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,b.jsxs)("button",{type:"button",onClick:i,className:`
                  inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2
                  ${"info"===h?"text-blue-500 hover:bg-blue-100 focus:ring-blue-600":""}
                  ${"success"===h?"text-green-500 hover:bg-green-100 focus:ring-green-600":""}
                  ${"warning"===h?"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600":""}
                  ${"error"===h?"text-red-500 hover:bg-red-100 focus:ring-red-600":""}
                `,children:[(0,b.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,b.jsx)(g.X,{className:"h-5 w-5"})]})})})]})})}],24452)},18180,a=>{"use strict";var b=a.i(87924);a.s(["Input",0,({label:a,error:c,helperText:d,className:e="",...f})=>{let g=f.id||f.name||Math.random().toString(36).substring(2,9);return(0,b.jsxs)("div",{className:"mb-4",children:[a&&(0,b.jsx)("label",{htmlFor:g,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("input",{id:g,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${c?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${e}
        `,...f}),c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-error-500",children:c}),d&&!c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})},"Select",0,({label:a,error:c,helperText:d,options:e,className:f="",...g})=>{let h=g.id||g.name||Math.random().toString(36).substring(2,9);return(0,b.jsxs)("div",{className:"mb-4",children:[a&&(0,b.jsx)("label",{htmlFor:h,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("select",{id:h,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${c?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${f}
        `,...g,children:e.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))}),c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-error-500",children:c}),d&&!c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})},"Textarea",0,({label:a,error:c,helperText:d,className:e="",...f})=>{let g=f.id||f.name||Math.random().toString(36).substring(2,9);return(0,b.jsxs)("div",{className:"mb-4",children:[a&&(0,b.jsx)("label",{htmlFor:g,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("textarea",{id:g,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${c?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${e}
        `,...f}),c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-error-500",children:c}),d&&!c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})}])},61730,a=>{"use strict";var b=a.i(78560);async function c(a){try{console.log("Checking registration completion for user:",a);let{data:c,error:d}=await b.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",a).single();if(d)throw console.error("Error fetching profile:",d),d;console.log("Profile data:",c);let e=!!(c&&c.full_name&&c.blood_group&&c.blood_group_proof_url);return console.log("Registration complete?",e),e}catch(a){return console.error("Error checking registration status:",a),!1}}a.s(["isRegistrationComplete",()=>c])},4879,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(34904),f=a.i(18180),g=a.i(24452),h=a.i(12466),i=a.i(78560),j=a.i(26017),k=a.i(53131),l=a.i(61730);function m(){let a=(0,d.useRouter)(),{user:m}=(0,k.useAuth)(),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)("loading"),[r,s]=(0,c.useState)(0),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)({fullName:"",phone:"",bloodGroup:"",proofType:"",proofFile:null}),[x,y]=(0,c.useState)({});(0,c.useEffect)(()=>{let b=async()=>{console.log("Initializing CompleteRegistration page");try{if(!m){console.log("No user found, redirecting to login"),a.push("/login");return}console.log("Current user:",m);let b=await (0,l.isRegistrationComplete)(m.id);if(console.log("Registration status:",b),b){console.log("Registration already complete, redirecting to dashboard"),a.push("/dashboard");return}let c=localStorage.getItem("pendingRegistration");if(console.log("Stored registration data:",c),!c){console.log("No pending registration data found"),o("Registration data not found. Please register again."),a.push("/register");return}try{let a=JSON.parse(c);if(console.log("Parsed registration data:",a),a.userId!==m.id)throw console.log("User ID mismatch:",{stored:a.userId,current:m.id}),Error("User ID mismatch");u(a),a.phone&&w(b=>({...b,phone:a.phone})),q("form")}catch(a){throw console.error("Error processing stored data:",a),Error("Invalid registration data")}}catch(b){console.error("Initialization error:",b),o(b.message||"Failed to load registration data"),a.push("/register")}};void 0!==m&&b()},[a,m]);let z=async b=>{let c;if(b.preventDefault(),c={},v.fullName.trim()||(c.fullName="Full name is required"),v.phone.trim()||(c.phone="Phone number is required"),v.bloodGroup||(c.bloodGroup="Blood group is required"),v.proofType||(c.proofType="Please select proof type"),v.proofFile?v.proofFile.size>1048576&&(c.proofFile="File size must be less than 1MB"):c.proofFile="Please upload proof document",y(c),0===Object.keys(c).length&&t){q("uploading"),s(25);try{let{data:{session:b},error:c}=await i.supabase.auth.getSession();if(c)throw c;if(!b){o("Authentication required. Please sign in again."),a.push("/login");return}if(b.user.id!==t.userId){o("Session mismatch. Please register again."),a.push("/register");return}let d=`${b.user.id}/${Date.now()}-${v.proofFile.name}`,{error:e}=await i.supabase.storage.from("proofs").upload(d,v.proofFile,{upsert:!1,contentType:v.proofFile.type});if(e)throw e;s(50),q("creating_profile");let{error:f}=await i.supabase.from("profiles").upsert({id:b.user.id,email:t.email,full_name:v.fullName,phone:v.phone,blood_group:v.bloodGroup,blood_group_proof_type:v.proofType,blood_group_proof_url:d,is_donor:!0,is_available:!0,location:{latitude:0,longitude:0,address:""}},{onConflict:"id",ignoreDuplicates:!1});if(f)throw f;s(75),q("finalizing");let{error:g}=await i.supabase.auth.updateUser({data:{registration_completed:!0,phone:v.phone}});if(g)throw g;s(100),q("completed"),localStorage.removeItem("pendingRegistration"),setTimeout(()=>a.push("/dashboard"),1500)}catch(a){console.error("Registration completion error:",a),o(a.message||"Failed to complete registration"),q("error")}}},A=a=>{let b=a.target.files?.[0];b&&(b.size>1048576?y(a=>({...a,proofFile:"File size must be less than 1MB"})):(y(a=>{let b={...a};return delete b.proofFile,b}),w(a=>({...a,proofFile:b}))))};return(0,b.jsx)("div",{className:"max-w-md mx-auto",children:(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardBody,{className:"text-center py-8",children:(()=>{switch(p){case"loading":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Loading Registration Data"}),(0,b.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin text-primary-500"})]});case"form":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Complete Your Registration"}),n&&(0,b.jsx)(g.Alert,{variant:"error",className:"mb-4",children:n}),(0,b.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,b.jsx)(f.Input,{label:"Full Name",value:v.fullName,onChange:a=>w({...v,fullName:a.target.value}),required:!0,autoComplete:"name",placeholder:"Enter your full name",error:x.fullName}),(0,b.jsx)(f.Input,{label:"Phone Number",type:"tel",value:v.phone,onChange:a=>w({...v,phone:a.target.value}),required:!0,autoComplete:"tel",placeholder:"Enter your phone number",error:x.phone}),(0,b.jsx)(f.Select,{label:"Blood Group",value:v.bloodGroup,onChange:a=>w({...v,bloodGroup:a.target.value}),options:[{value:"",label:"Select Blood Group"},{value:"A+",label:"A+"},{value:"A-",label:"A-"},{value:"B+",label:"B+"},{value:"B-",label:"B-"},{value:"AB+",label:"AB+"},{value:"AB-",label:"AB-"},{value:"O+",label:"O+"},{value:"O-",label:"O-"}],required:!0,error:x.bloodGroup}),(0,b.jsx)(f.Select,{label:"Blood Group Proof Type",value:v.proofType,onChange:a=>w({...v,proofType:a.target.value}),options:[{value:"",label:"Select Proof Type"},{value:"medical_certificate",label:"Medical Certificate"},{value:"hospital_report",label:"Hospital Report"},{value:"blood_donation_card",label:"Blood Donation Card"},{value:"lab_report",label:"Laboratory Report"}],required:!0,error:x.proofType}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Proof"}),(0,b.jsx)(f.Input,{type:"file",onChange:A,accept:".pdf,.jpg,.jpeg,.png",required:!0,className:"w-full",error:x.proofFile}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Accepted formats: PDF, JPG, JPEG, PNG (Max size: 1MB)"})]}),(0,b.jsx)(h.Button,{type:"submit",variant:"primary",className:"w-full",children:"Complete Registration"})]})]});case"uploading":case"creating_profile":case"finalizing":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Completing Registration"}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-4",children:(0,b.jsx)("div",{className:"bg-primary-500 h-2.5 rounded-full transition-all duration-500",style:{width:`${r}%`}})}),(0,b.jsxs)("p",{className:"text-gray-600",children:["uploading"===p&&"Uploading your documents...","creating_profile"===p&&"Creating your profile...","finalizing"===p&&"Finalizing your registration..."]})]});case"completed":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-green-600 mb-4",children:"Registration Complete!"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Your account has been successfully set up."}),(0,b.jsx)("p",{className:"text-gray-600",children:"Redirecting you to the dashboard..."})]});case"error":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-4",children:"Registration Error"}),(0,b.jsx)(g.Alert,{variant:"error",className:"mb-4",children:n}),(0,b.jsx)(h.Button,{variant:"primary",onClick:()=>a.push("/register"),className:"w-full",children:"Try Again"})]})}})()})})})}a.s(["default",()=>m])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__dbe847a0._.js.map