{"version":3,"sources":["../../../../components/ui/Card.tsx","../../../../utils/auth.ts","../../../../app/%28auth%29/login/content.tsx"],"sourcesContent":["import React from 'react';\n\ninterface CardProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const Card: React.FC<CardProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`bg-white rounded-lg shadow-md overflow-hidden ${className}`}>\n      {children}\n    </div>\n  );\n};\n\ninterface CardHeaderProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const CardHeader: React.FC<CardHeaderProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`px-6 py-4 border-b border-gray-200 ${className}`}>\n      {children}\n    </div>\n  );\n};\n\ninterface CardBodyProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const CardBody: React.FC<CardBodyProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`px-6 py-4 ${className}`}>\n      {children}\n    </div>\n  );\n};\n\ninterface CardFooterProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const CardFooter: React.FC<CardFooterProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`px-6 py-4 border-t border-gray-200 ${className}`}>\n      {children}\n    </div>\n  );\n};","import { supabase } from '../lib/supabase';\n\nexport async function isRegistrationComplete(userId: string): Promise<boolean> {\n    try {\n\n        const { data: profile, error } = await supabase\n            .from('profiles')\n            .select('full_name, blood_group, blood_group_proof_url')\n            .eq('id', userId)\n            .single();\n\n        if (error) {\n            console.error('Error fetching profile:', error);\n            throw error;\n        }\n\n\n\n        const isComplete = !!(\n            profile &&\n            profile.full_name &&\n            profile.blood_group &&\n            profile.blood_group_proof_url\n        );\n\n\n        return isComplete;\n    } catch (error) {\n        console.error('Error checking registration status:', error);\n        return false;\n    }\n} ","\"use client\";\n\nimport React, { useState, useEffect } from 'react';\nimport { useRouter } from 'next/navigation';\nimport Link from 'next/link';\nimport { LogIn } from 'lucide-react';\nimport { Card, CardHeader, CardBody } from '@/components/ui/Card';\nimport { Input } from '@/components/ui/Input';\nimport { Button } from '@/components/ui/Button';\nimport { Alert } from '@/components/ui/Alert';\nimport { useAuth } from '@/context/AuthContext';\nimport { supabase } from '@/lib/supabase';\nimport { isRegistrationComplete } from '@/utils/auth';\n\nexport default function LoginPage() {\n    const router = useRouter();\n    const { signIn, user } = useAuth();\n    const [email, setEmail] = useState('');\n    const [password, setPassword] = useState('');\n    const [error, setError] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const [isGoogleLoading, setIsGoogleLoading] = useState(false);\n\n    useEffect(() => {\n        const checkUserRegistration = async () => {\n            if (user) {\n\n                try {\n                    const isComplete = await isRegistrationComplete(user.id);\n\n\n                    if (!isComplete) {\n\n                        // Store basic info for registration completion\n                        const pendingData = {\n                            userId: user.id,\n                            email: user.email,\n                            phone: user.phone || ''\n                        };\n\n                        localStorage.setItem('pendingRegistration', JSON.stringify(pendingData));\n                        router.push('/complete-registration');\n                    } else {\n\n                        router.push('/dashboard');\n                    }\n                } catch (err) {\n                    console.error('Error in registration check');\n                    // On error, we'll treat it as incomplete registration\n                    const pendingData = {\n                        userId: user.id,\n                        email: user.email,\n                        phone: user.phone || ''\n                    };\n                    localStorage.setItem('pendingRegistration', JSON.stringify(pendingData));\n                    router.push('/complete-registration');\n                }\n            }\n        };\n\n        checkUserRegistration();\n    }, [user, router]);\n\n    const handleSubmit = async (e: React.FormEvent) => {\n        e.preventDefault();\n        setError('');\n        setIsLoading(true);\n\n        try {\n            await signIn(email, password);\n            // The navigation will be handled by the useEffect above\n        } catch (err: any) {\n            if (err.message.includes('Invalid login credentials')) {\n                setError('Invalid email or password');\n            } else if (err.message.includes('Email not confirmed')) {\n                setError('Please verify your email address before signing in');\n            } else {\n                setError(err.message || 'An error occurred during sign in');\n            }\n            setIsLoading(false);\n        }\n    };\n\n    const handleGoogleSignIn = async () => {\n        setIsGoogleLoading(true);\n        setError('');\n        try {\n            const { error } = await supabase.auth.signInWithOAuth({\n                provider: 'google',\n                options: {\n                    redirectTo: `${window.location.origin}/auth/callback`,\n                    queryParams: {\n                        access_type: 'offline',\n                        prompt: 'consent',\n                    },\n                },\n            });\n\n            if (error) {\n                throw error;\n            }\n        } catch (err: any) {\n            console.error('Google sign in error');\n            setError(err.message || 'Failed to sign in with Google');\n            setIsGoogleLoading(false);\n        }\n    };\n\n    return (\n        <div className=\"max-w-md mx-auto\">\n            <Card>\n                <CardHeader>\n                    <h1 className=\"text-2xl font-bold text-center text-gray-900\">Welcome Back</h1>\n                    <p className=\"text-center text-gray-600 mt-2\">Sign in to continue to your account</p>\n                </CardHeader>\n                <CardBody>\n                    {error && (\n                        <Alert variant=\"error\" className=\"mb-4\">\n                            {error}\n                        </Alert>\n                    )}\n\n                    <form onSubmit={handleSubmit} className=\"space-y-4\">\n                        <Input\n                            label=\"Email\"\n                            type=\"email\"\n                            value={email}\n                            onChange={(e) => setEmail(e.target.value)}\n                            required\n                            autoComplete=\"email\"\n                        />\n                        <Input\n                            label=\"Password\"\n                            type=\"password\"\n                            value={password}\n                            onChange={(e) => setPassword(e.target.value)}\n                            required\n                            autoComplete=\"current-password\"\n                        />\n\n                        <Button\n                            type=\"submit\"\n                            variant=\"primary\"\n                            className=\"w-full\"\n                            isLoading={isLoading}\n                            leftIcon={<LogIn className=\"h-5 w-5\" />}\n                        >\n                            Sign In\n                        </Button>\n                    </form>\n\n                    <div className=\"relative my-6\">\n                        <div className=\"absolute inset-0 flex items-center\">\n                            <div className=\"w-full border-t border-gray-300\"></div>\n                        </div>\n                        <div className=\"relative flex justify-center text-sm\">\n                            <span className=\"px-2 bg-white text-gray-500\">Or continue with</span>\n                        </div>\n                    </div>\n\n                    <Button\n                        type=\"button\"\n                        variant=\"secondary\"\n                        className=\"w-full\"\n                        onClick={handleGoogleSignIn}\n                        isLoading={isGoogleLoading}\n                    >\n                        Sign in with Google\n                    </Button>\n\n                    <div className=\"mt-6 text-center space-y-2\">\n                        <p className=\"text-sm text-gray-600\">\n                            <Link href=\"/forgot-password\" className=\"text-primary-500 hover:text-primary-600\">\n                                Forgot your password?\n                            </Link>\n                        </p>\n                        <p className=\"text-sm text-gray-600\">\n                            Don't have an account?{' '}\n                            <Link href=\"/register\" className=\"text-primary-500 hover:text-primary-600\">\n                                Sign up\n                            </Link>\n                        </p>\n                    </div>\n                </CardBody>\n            </Card>\n        </div>\n    );\n}\n"],"names":[],"mappings":"sEAOyC,CAAC,UAAE,CAAQ,WAAE,EAAY,EAAE,CAAE,GAElE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,8CAA8C,EAAE,EAAA,CAAW,UACzE,iBAuB0C,CAAC,UAAE,CAAQ,WAAE,EAAY,EAAE,CAAE,GAE1E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,UAAU,EAAE,EAAA,CAAW,UACrC,mBAhB8C,CAAC,UAAE,CAAQ,WAAE,EAAY,EAAE,CAAE,GAE9E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,mCAAmC,EAAE,EAAA,CAAW,UAC9D,8BCvBP,IAAA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAuB,CAAc,EACvD,GAAI,CAEA,GAAM,CAAE,KAAM,CAAO,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC1C,IAAI,CAAC,YACL,MAAM,CAAC,iDACP,EAAE,CAAC,KAAM,GACT,MAAM,GAEX,GAAI,EAEA,KAFO,CACP,QAAQ,KAAK,CAAC,0BAA2B,GACnC,EAaV,MARmB,CAAC,AAQb,CARc,CACjB,GACA,EAAQ,SAAS,EACjB,EAAQ,WAAW,EACnB,EAAQ,qBAAA,AACZ,CAIJ,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,sCAAuC,IAC9C,CACX,CACJ,gFC7BA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEe,SAAS,IACpB,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,QAAE,CAAM,MAAE,CAAI,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IAC1B,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAW,EAAa,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACrC,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAEvD,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KAqCN,CApC8B,UAC1B,GAAI,EAEA,GAAI,CAFE,AAMF,GAHmB,CAGf,CAAC,IAHoB,CAAA,EAAA,EAAA,sBAAA,AAAsB,EAAC,EAAK,EAAE,EAgBnD,EAAO,IAAI,CAAC,kBAbC,CAGb,IAAM,EAAc,CAChB,OAAQ,EAAK,EAAE,CACf,MAAO,EAAK,KAAK,CACjB,MAAO,EAAK,KAAK,EAAI,EACzB,EAEA,aAAa,OAAO,CAAC,sBAAuB,KAAK,SAAS,CAAC,IAC3D,EAAO,IAAI,CAAC,yBAChB,CAIJ,CAAE,KAJS,CAIF,EAAK,CACV,QAAQ,KAAK,CAAC,+BAEd,IAAM,EAAc,CAChB,OAAQ,EAAK,EAAE,CACf,MAAO,EAAK,KAAK,CACjB,MAAO,EAAK,KAAK,EAAI,EACzB,EACA,aAAa,OAAO,CAAC,sBAAuB,KAAK,SAAS,CAAC,IAC3D,EAAO,IAAI,CAAC,yBAChB,EAER,GAGJ,EAAG,CAAC,EAAM,EAAO,EAEjB,IAAM,EAAe,MAAO,IACxB,EAAE,cAAc,GAChB,EAAS,IACT,GAAa,GAEb,GAAI,CACA,MAAM,EAAO,EAAO,EAExB,CAAE,MAAO,EAAU,CACX,EAAI,OAAO,CAAC,QAAQ,CAAC,6BACrB,CADmD,CAC1C,6BACF,EAAI,OAAO,CAAC,QAAQ,CAAC,uBAC5B,CADoD,CAC3C,sDAET,EAAS,EAAI,OAAO,EAAI,oCAE5B,GAAa,EACjB,CACJ,EAEM,EAAqB,UACvB,GAAmB,GACnB,EAAS,IACT,GAAI,CACA,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAAC,IAAI,CAAC,eAAe,CAAC,CAClD,SAAU,SACV,QAAS,CACL,WAAY,CAAA,EAAG,OAAO,QAAQ,CAAC,MAAM,CAAC,cAAc,CAAC,CACrD,YAAa,CACT,YAAa,UACb,OAAQ,SACZ,CACJ,CACJ,GAEA,GAAI,EACA,KADO,CACD,CAEd,CAAE,MAAO,EAAU,CACf,QAAQ,KAAK,CAAC,wBACd,EAAS,EAAI,OAAO,EAAI,iCACxB,GAAmB,EACvB,CACJ,EAEA,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,4BACX,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,IAAI,CAAA,WACD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,UAAU,CAAA,WACP,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,wDAA+C,iBAC7D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,0CAAiC,2CAElD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,WACJ,GACG,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,QAAQ,QAAQ,UAAU,gBAC5B,IAIT,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAc,UAAU,sBACpC,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACF,MAAM,QACN,KAAK,QACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAS,EAAE,MAAM,CAAC,KAAK,EACxC,QAAQ,CAAA,CAAA,EACR,aAAa,UAEjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CACF,MAAM,WACN,KAAK,WACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAY,EAAE,MAAM,CAAC,KAAK,EAC3C,QAAQ,CAAA,CAAA,EACR,aAAa,qBAGjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACH,KAAK,SACL,QAAQ,UACR,UAAU,SACV,UAAW,EACX,SAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,KAAK,CAAA,CAAC,UAAU,qBAC9B,eAKL,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0BACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAEnB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gDACX,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,uCAA8B,0BAItD,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,MAAM,CAAA,CACH,KAAK,SACL,QAAQ,YACR,UAAU,SACV,QAAS,EACT,UAAW,WACd,wBAID,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uCACX,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCACT,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,mBAAmB,UAAU,mDAA0C,4BAItF,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,kCAAwB,yBACV,IACvB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAI,CAAA,CAAC,KAAK,YAAY,UAAU,mDAA0C,yBASvG"}