module.exports=[42987,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(38246),e=a.i(19721),f=a.i(24445),g=a.i(24987);let h=(0,a.i(70106).default)("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);var i=a.i(88736),j=a.i(12466),k=a.i(18180),l=a.i(50944),m=a.i(33508),n=a.i(31067),o=a.i(24452),p=a.i(53131),q=a.i(78560);function r({isOpen:a,onClose:d,onSuccess:e,message:f="Sign in to continue"}){let{signIn:g}=(0,p.useAuth)(),h=(0,l.useRouter)(),[i,r]=(0,c.useState)(""),[s,t]=(0,c.useState)(""),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(!1);if(!a)return null;let A=async a=>{a.preventDefault(),v(""),x(!0);try{await g(i,s),e()}catch(a){a.message.includes("Invalid login credentials")?v("Invalid email or password"):a.message.includes("Email not confirmed")?v("Please verify your email address before signing in"):v(a.message||"An error occurred during sign in")}finally{x(!1)}},B=async()=>{z(!0),v("");try{let{error:a}=await q.supabase.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});if(a)throw a}catch(a){console.error("Google sign in error",a),v(a.message||"Failed to sign in with Google"),z(!1)}};return(0,b.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm animate-in fade-in duration-200",children:(0,b.jsxs)("div",{className:"relative bg-white rounded-xl shadow-2xl w-full max-w-md overflow-hidden animate-in zoom-in-95 duration-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center p-6 border-b border-gray-100",children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:f}),(0,b.jsx)("button",{onClick:d,className:"text-gray-400 hover:text-gray-600 transition-colors",children:(0,b.jsx)(m.X,{size:24})})]}),(0,b.jsxs)("div",{className:"p-6",children:[u&&(0,b.jsx)(o.Alert,{variant:"error",className:"mb-4",children:u}),(0,b.jsxs)("form",{onSubmit:A,className:"space-y-4",children:[(0,b.jsx)(k.Input,{label:"Email",type:"email",value:i,onChange:a=>r(a.target.value),required:!0,autoComplete:"email"}),(0,b.jsx)(k.Input,{label:"Password",type:"password",value:s,onChange:a=>t(a.target.value),required:!0,autoComplete:"current-password"}),(0,b.jsx)(j.Button,{type:"submit",variant:"primary",className:"w-full",isLoading:w,leftIcon:(0,b.jsx)(n.LogIn,{className:"h-5 w-5"}),children:"Sign In"})]}),(0,b.jsxs)("div",{className:"relative my-6",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,b.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,b.jsx)("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),(0,b.jsx)(j.Button,{type:"button",variant:"secondary",className:"w-full",onClick:B,isLoading:y,children:"Sign in with Google"}),(0,b.jsxs)("div",{className:"mt-6 text-center text-sm text-gray-600",children:["Don't have an account?"," ",(0,b.jsx)("button",{onClick:()=>h.push("/register"),className:"text-primary-600 hover:text-primary-700 font-medium hover:underline",children:"Sign up"})]})]})]})})}var s=a.i(25551),t=a.i(73922),u=a.i(34904),v=a.i(17139);let w=()=>(0,b.jsx)(u.Card,{className:"overflow-hidden border-l-4 border-gray-200",children:(0,b.jsx)(u.CardBody,{className:"p-0",children:(0,b.jsxs)("div",{className:"p-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(v.Skeleton,{className:"w-10 h-10 rounded-full"}),(0,b.jsxs)("div",{className:"ml-3 space-y-2",children:[(0,b.jsx)(v.Skeleton,{className:"h-5 w-32"}),(0,b.jsx)(v.Skeleton,{className:"h-4 w-24"})]})]}),(0,b.jsx)(v.Skeleton,{className:"h-6 w-20 ml-2 rounded-full"})]}),(0,b.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(v.Skeleton,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(v.Skeleton,{className:"h-4 w-48"})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(v.Skeleton,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(v.Skeleton,{className:"h-4 w-32"})]}),(0,b.jsxs)("div",{className:"flex items-center",children:[(0,b.jsx)(v.Skeleton,{className:"h-4 w-4 mr-2"}),(0,b.jsx)(v.Skeleton,{className:"h-4 w-40"})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex justify-between items-center gap-2",children:[(0,b.jsx)(v.Skeleton,{className:"h-8 w-20"}),(0,b.jsx)(v.Skeleton,{className:"h-8 w-28"})]})]})})}),x=(0,e.default)(async()=>{},{loadableGenerated:{modules:[5481]},ssr:!1,loading:()=>(0,b.jsx)("div",{className:"h-[400px] bg-gray-100 rounded-lg animate-pulse"})});function y(){let{user:a,refreshProfile:e}=(0,p.useAuth)(),{requests:l,myDonations:m,refreshRequests:n,loading:u}=(0,t.useRequests)(),[v,y]=(0,c.useState)([]),[z,A]=(0,c.useState)(null),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)("list"),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)({bloodGroup:"all",urgency:"all",locationSearch:""});(0,c.useEffect)(()=>{let a=l;if("all"!==J.bloodGroup&&(a=a.filter(a=>a.blood_group===J.bloodGroup)),"all"!==J.urgency&&(a=a.filter(a=>a.urgency_level===J.urgency)),J.locationSearch){let b=J.locationSearch.toLowerCase();a=a.filter(a=>a.city&&a.city.toLowerCase().includes(b)||a.zipcode&&a.zipcode.includes(b)||a.hospital_address&&a.hospital_address.toLowerCase().includes(b))}y(a)},[l,J]);let[L,M]=(0,c.useState)({isOpen:!1,pin:"",hospitalName:""}),[N,O]=(0,c.useState)({isOpen:!1,request:null}),[P,Q]=(0,c.useState)({isOpen:!1,request:null}),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(!1),V=async()=>{if(a&&4===R.length){U(!0);try{let{error:b}=await q.supabase.from("profiles").update({donor_pin:R}).eq("id",a.id);if(b)throw b;await e(),Q({isOpen:!1,request:null}),P.request&&O({isOpen:!0,request:P.request})}catch(a){console.error("Error creating PIN"),I(a.message||"Failed to create PIN")}finally{U(!1)}}},W=async()=>{if(N.request&&a)try{let b=a.donor_pin;if(!b)return void I("Donor PIN not found. Please refresh and try again.");let{error:c}=await q.supabase.from("donations").insert({request_id:N.request.id,donor_id:a.id,status:"pending",otp:b});if(c)throw c;O({isOpen:!1,request:null}),await n(),M({isOpen:!0,pin:b,hospitalName:N.request.hospital_name})}catch(a){console.error("Donation error"),I(a.message||"Failed to process donation request"),O({isOpen:!1,request:null})}};return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Blood Requests"}),(0,b.jsxs)("div",{className:"flex w-full md:w-auto gap-4",children:[(0,b.jsxs)("div",{className:"flex bg-gray-100 p-1 rounded-lg",children:[(0,b.jsx)("button",{onClick:()=>G("list"),className:`p-2 rounded-md ${"list"===F?"bg-white shadow-sm text-primary-600":"text-gray-500"}`,children:(0,b.jsx)(h,{className:"h-5 w-5"})}),(0,b.jsx)("button",{onClick:()=>G("map"),className:`p-2 rounded-md ${"map"===F?"bg-white shadow-sm text-primary-600":"text-gray-500"}`,children:(0,b.jsx)(g.MapPin,{className:"h-5 w-5"})})]}),a&&(0,b.jsx)(d.default,{href:"/requests/new",className:"flex-1 md:flex-none",children:(0,b.jsx)(j.Button,{variant:"primary",className:"w-full md:w-auto",children:"Create Request"})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsx)(k.Select,{label:"Blood Group",value:J.bloodGroup,onChange:a=>{K(b=>({...b,bloodGroup:a.target.value}))},options:[{value:"all",label:"All Blood Groups"},{value:"A+",label:"A+"},{value:"A-",label:"A-"},{value:"B+",label:"B+"},{value:"B-",label:"B-"},{value:"AB+",label:"AB+"},{value:"AB-",label:"AB-"},{value:"O+",label:"O+"},{value:"O-",label:"O-"}]}),(0,b.jsx)(k.Select,{label:"Urgency",value:J.urgency,onChange:a=>{K(b=>({...b,urgency:a.target.value}))},options:[{value:"all",label:"All Urgency Levels"},{value:"High",label:"High"},{value:"Medium",label:"Medium"},{value:"Low",label:"Low"}]}),(0,b.jsx)("div",{className:"md:col-span-2",children:(0,b.jsx)(k.Input,{label:"Search Location",placeholder:"Search by City, Zip Code, or Hospital",value:J.locationSearch,onChange:a=>K(b=>({...b,locationSearch:a.target.value}))})})]}),H&&(0,b.jsx)(o.Alert,{variant:"error",onClose:()=>I(""),children:H}),u?[1,2,3].map(a=>(0,b.jsx)(w,{},a)):0===v.length?(0,b.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg shadow-sm border border-gray-100 flex flex-col items-center",children:[(0,b.jsx)("div",{className:"bg-gray-50 p-4 rounded-full mb-4",children:(0,b.jsx)(h,{className:"h-8 w-8 text-gray-400"})}),(0,b.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-1",children:"No requests found"}),(0,b.jsx)("p",{className:"text-gray-500 mb-4 text-sm max-w-sm",children:"There are currently no blood requests matching your filter. Check back later or adjust your filters."})]}):(0,b.jsx)("div",{className:"space-y-4",children:"list"===F?v.map(c=>(0,b.jsx)(f.BloodRequestCard,{request:c,onRespond:a?.id===c.user_id?void 0:()=>(b=>{if(!a){E(b),C(!0);return}(0,s.isBloodCompatible)(a.blood_group,b.blood_group)?a.donor_pin?O({isOpen:!0,request:b}):Q({isOpen:!0,request:b}):I(`Medical Safety: Your blood group (${a.blood_group}) is not compatible with the patient (${b.blood_group}).`)})(c),onPendingClick:()=>{a&&a.donor_pin&&M({isOpen:!0,pin:a.donor_pin,hospitalName:c.hospital_name})},userBloodGroup:a?.blood_group,hasOffered:m.has(c.id),isOwnRequest:a?.id===c.user_id},c.id)):(0,b.jsx)("div",{className:"h-[600px] rounded-xl overflow-hidden border border-gray-200",children:(0,b.jsx)(x,{center:{lat:20.5937,lng:78.9629},zoom:5,markers:v.map(a=>({position:{lat:a.location.latitude,lng:a.location.longitude},title:`${a.blood_group} Blood Needed`,description:`${a.hospital_name} - ${a.units_needed} Unit(s)`}))})})}),(0,b.jsx)(i.Modal,{isOpen:P.isOpen,onClose:()=>Q({isOpen:!1,request:null}),title:"Create Donor PIN",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("p",{className:"text-gray-600",children:["To ensure security, please create a ",(0,b.jsx)("strong",{children:"4-digit PIN"}),". You will use this PIN for all future donations to verify your identity."]}),(0,b.jsx)("div",{className:"bg-yellow-50 p-3 rounded-md text-yellow-800 text-sm",children:"This PIN is permanent. Please choose one you will remember."}),(0,b.jsx)(k.Input,{label:"Enter 4-digit PIN",placeholder:"e.g. 1234",value:R,onChange:a=>{S(a.target.value.replace(/\D/g,"").slice(0,4))},maxLength:4,className:"text-center text-2xl tracking-widest"}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)(j.Button,{className:"w-full",onClick:V,disabled:4!==R.length||T,isLoading:T,children:"Save PIN & Continue"})})]})}),(0,b.jsx)(i.Modal,{isOpen:N.isOpen,onClose:()=>O({isOpen:!1,request:null}),title:"Confirm Donation Details",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Hospital"}),(0,b.jsx)("p",{className:"font-medium",children:N.request?.hospital_name}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:N.request?.hospital_address})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Blood Group"}),(0,b.jsx)("p",{className:"font-bold text-lg text-primary-600",children:N.request?.blood_group})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Units Needed"}),(0,b.jsxs)("p",{className:"font-medium",children:[N.request?.units_needed," Unit(s)"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Contact Person"}),(0,b.jsx)("p",{className:"font-medium",children:N.request?.contact_name}),(0,b.jsx)("p",{className:"text-sm text-primary-600 font-medium",children:N.request?.contact_phone})]}),N.request?.notes&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-gray-500",children:"Notes"}),(0,b.jsx)("p",{className:"text-sm italic text-gray-700",children:N.request?.notes})]})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600",children:"By connecting, you agree to visit the hospital and donate blood for this request."}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)(j.Button,{variant:"secondary",className:"flex-1",onClick:()=>O({isOpen:!1,request:null}),children:"Cancel"}),(0,b.jsx)(j.Button,{className:"flex-1",onClick:W,children:"Confirm & Donate"})]})]})}),(0,b.jsx)(r,{isOpen:B,onClose:()=>{C(!1),E(null)},onSuccess:()=>{C(!1),D&&console.log("User logged in via modal")},message:"Login to Donate"}),(0,b.jsx)(i.Modal,{isOpen:L.isOpen,onClose:()=>M({...L,isOpen:!1}),title:"Donation Initiated",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("p",{children:["Thank you for offering to donate at ",(0,b.jsx)("strong",{children:L.hospitalName}),"!"]}),(0,b.jsxs)("div",{className:"bg-primary-50 p-4 rounded-lg text-center",children:[(0,b.jsx)("p",{className:"text-sm text-primary-700 mb-1",children:"Your Verification PIN"}),(0,b.jsx)("p",{className:"text-3xl font-bold text-primary-600 tracking-wider",children:L.pin})]}),(0,b.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,b.jsx)("p",{className:"mb-2",children:(0,b.jsx)("strong",{children:"Next Steps:"})}),(0,b.jsxs)("ol",{className:"list-decimal list-inside space-y-1",children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("strong",{children:"Contact the Requestee:"}),' Their phone number will be visible in "My Donations".']}),(0,b.jsx)("li",{children:"Visit the hospital location."}),(0,b.jsxs)("li",{children:["Share this ",(0,b.jsx)("strong",{children:"Donor PIN"})," with them to verify your donation."]})]})]}),(0,b.jsx)("div",{className:"pt-2",children:(0,b.jsx)(j.Button,{className:"w-full",onClick:()=>M({...L,isOpen:!1}),children:"Close"})})]})})]})}a.s(["default",()=>y],42987)}];

//# sourceMappingURL=app_requests_content_tsx_b1b2d5cf._.js.map