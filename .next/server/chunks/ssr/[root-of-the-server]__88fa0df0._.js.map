{"version":3,"sources":["../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/hooks-client-context.ts","../../../../node_modules/next/src/server/route-modules/app-page/vendored/contexts/server-inserted-html.ts","../../../../components/ui/Card.tsx","../../../../node_modules/lucide-react/src/icons/loader-2.ts","../../../../utils/auth.ts","../../../../components/ProtectedRoute.tsx","../../../../components/RegistrationGuard.tsx","../../../../app/%28protected%29/layout.tsx"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].HooksClientContext\n","module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['contexts'].ServerInsertedHtml\n","import React from 'react';\n\ninterface CardProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const Card: React.FC<CardProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`bg-white rounded-lg shadow-md overflow-hidden ${className}`}>\n      {children}\n    </div>\n  );\n};\n\ninterface CardHeaderProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const CardHeader: React.FC<CardHeaderProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`px-6 py-4 border-b border-gray-200 ${className}`}>\n      {children}\n    </div>\n  );\n};\n\ninterface CardBodyProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const CardBody: React.FC<CardBodyProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`px-6 py-4 ${className}`}>\n      {children}\n    </div>\n  );\n};\n\ninterface CardFooterProps {\n  children: React.ReactNode;\n  className?: string;\n}\n\nexport const CardFooter: React.FC<CardFooterProps> = ({ children, className = '' }) => {\n  return (\n    <div className={`px-6 py-4 border-t border-gray-200 ${className}`}>\n      {children}\n    </div>\n  );\n};","import createLucideIcon from '../createLucideIcon';\n\n/**\n * @component @name Loader2\n * @description Lucide SVG icon component, renders SVG Element with children.\n *\n * @preview ![img](data:image/svg+xml;base64,PHN2ZyAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogIHdpZHRoPSIyNCIKICBoZWlnaHQ9IjI0IgogIHZpZXdCb3g9IjAgMCAyNCAyNCIKICBmaWxsPSJub25lIgogIHN0cm9rZT0iIzAwMCIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmZmY7IGJvcmRlci1yYWRpdXM6IDJweCIKICBzdHJva2Utd2lkdGg9IjIiCiAgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIgogIHN0cm9rZS1saW5lam9pbj0icm91bmQiCj4KICA8cGF0aCBkPSJNMjEgMTJhOSA5IDAgMSAxLTYuMjE5LTguNTYiIC8+Cjwvc3ZnPgo=) - https://lucide.dev/icons/loader-2\n * @see https://lucide.dev/guide/packages/lucide-react - Documentation\n *\n * @param {Object} props - Lucide icons props and any valid SVG attribute\n * @returns {JSX.Element} JSX Element\n *\n */\nconst Loader2 = createLucideIcon('Loader2', [\n  ['path', { d: 'M21 12a9 9 0 1 1-6.219-8.56', key: '13zald' }],\n]);\n\nexport default Loader2;\n","import { supabase } from '../lib/supabase';\n\nexport async function isRegistrationComplete(userId: string): Promise<boolean> {\n    try {\n        console.log('Checking registration completion for user:', userId);\n        const { data: profile, error } = await supabase\n            .from('profiles')\n            .select('full_name, blood_group, blood_group_proof_url')\n            .eq('id', userId)\n            .single();\n\n        if (error) {\n            console.error('Error fetching profile:', error);\n            throw error;\n        }\n\n        console.log('Profile data:', profile);\n\n        const isComplete = !!(\n            profile &&\n            profile.full_name &&\n            profile.blood_group &&\n            profile.blood_group_proof_url\n        );\n\n        console.log('Registration complete?', isComplete);\n        return isComplete;\n    } catch (error) {\n        console.error('Error checking registration status:', error);\n        return false;\n    }\n} ","\"use client\";\n\n// components/ProtectedRoute.tsx\nimport { useEffect, useState } from 'react';\nimport { useAuth } from '../context/AuthContext';\nimport { useRouter, usePathname } from 'next/navigation';\n\nexport function ProtectedRoute({ children }: { children: React.ReactNode }) {\n  const { user, session, loading, error, refreshProfile } = useAuth();\n  const router = useRouter();\n  const pathname = usePathname();\n  const [retryCount, setRetryCount] = useState(0);\n\n  useEffect(() => {\n    console.log('ProtectedRoute state:', { user, loading, session });\n  }, [user, loading, session]);\n\n  // Handle missing profile data despite active session\n  useEffect(() => {\n    if (session?.user?.id && !user && !loading && retryCount < 3) {\n      console.log(`Profile missing despite active session, refreshing (attempt ${retryCount + 1})`);\n      refreshProfile();\n      setRetryCount(prevCount => prevCount + 1);\n    }\n  }, [session, user, loading, refreshProfile, retryCount]);\n\n  if (loading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-center\">\n          <h2 className=\"text-xl font-semibold mb-2\">Loading...</h2>\n          <p className=\"text-gray-600\">Please wait while we prepare your dashboard.</p>\n        </div>\n      </div>\n    );\n  }\n\n  // After 3 retries, if still no user profile, redirect to login\n  useEffect(() => {\n    if ((!user || !session) && (!loading || retryCount >= 3)) {\n      router.push(`/login?from=${pathname}`);\n    }\n  }, [user, session, loading, retryCount, router, pathname]);\n\n  if ((!user || !session) && (!loading || retryCount >= 3)) {\n    return null; // Or a loading spinner while redirecting\n  }\n\n  console.log('ProtectedRoute: Rendering protected content');\n  return <>{children}</>;\n}","\"use client\";\n\nimport React, { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useAuth } from '../context/AuthContext';\nimport { isRegistrationComplete } from '../utils/auth';\nimport { Card, CardBody } from './ui/Card';\nimport { Loader2 } from 'lucide-react';\n\ninterface RegistrationGuardProps {\n    children: React.ReactNode;\n}\n\nexport function RegistrationGuard({ children }: RegistrationGuardProps) {\n    const router = useRouter();\n    const { user } = useAuth();\n    const [isChecking, setIsChecking] = useState(true);\n\n    useEffect(() => {\n        const checkRegistration = async () => {\n            console.log('RegistrationGuard: Checking registration status');\n            if (!user) {\n                console.log('RegistrationGuard: No user found, redirecting to login');\n                router.push('/login');\n                return;\n            }\n\n            try {\n                console.log('RegistrationGuard: Checking completion for user:', user.id);\n                const isComplete = await isRegistrationComplete(user.id);\n                console.log('RegistrationGuard: Registration complete?', isComplete);\n\n                if (!isComplete) {\n                    console.log('RegistrationGuard: Registration incomplete, redirecting to complete registration');\n                    // Store basic info for registration completion\n                    const pendingData = {\n                        userId: user.id,\n                        email: user.email,\n                        phone: user.phone || ''\n                    };\n                    console.log('RegistrationGuard: Storing pending data:', pendingData);\n                    localStorage.setItem('pendingRegistration', JSON.stringify(pendingData));\n                    router.push('/complete-registration');\n                } else {\n                    console.log('RegistrationGuard: Registration complete, allowing access');\n                    setIsChecking(false);\n                }\n            } catch (error) {\n                console.error('RegistrationGuard: Error checking registration:', error);\n                // On error, redirect to complete registration\n                const pendingData = {\n                    userId: user.id,\n                    email: user.email,\n                    phone: user.phone || ''\n                };\n                localStorage.setItem('pendingRegistration', JSON.stringify(pendingData));\n                router.push('/complete-registration');\n            }\n        };\n\n        checkRegistration();\n    }, [user, router]);\n\n    if (isChecking) {\n        return (\n            <div className=\"max-w-md mx-auto\">\n                <Card>\n                    <CardBody className=\"text-center py-8\">\n                        <h2 className=\"text-xl font-semibold mb-4\">Checking Profile</h2>\n                        <Loader2 className=\"h-8 w-8 animate-spin text-primary-500 mx-auto\" />\n                    </CardBody>\n                </Card>\n            </div>\n        );\n    }\n\n    return <>{children}</>;\n} ","\"use client\";\n\nimport React from 'react';\nimport { ProtectedRoute } from '@/components/ProtectedRoute';\nimport { RegistrationGuard } from '@/components/RegistrationGuard';\n\nexport default function ProtectedLayout({\n    children,\n}: {\n    children: React.ReactNode;\n}) {\n    return (\n        <ProtectedRoute>\n            <RegistrationGuard>\n                {children}\n            </RegistrationGuard>\n        </ProtectedRoute>\n    );\n}\n"],"names":["module","exports","require","vendored","HooksClientContext","ServerInsertedHtml"],"mappings":"gjBAAAA,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACC,kBAAkB,+BCFzCJ,EAAOC,OAAO,CACZC,EAAQ,CAAA,CAAA,IAAA,GACRC,QAAQ,CAAC,QAAW,CAACE,kBAAkB,wDCKA,CAAC,UAAE,CAAQ,WAAE,EAAY,EAAE,CAAE,GAElE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,8CAA8C,EAAE,EAAA,CAAW,UACzE,iBAuB0C,CAAC,UAAE,CAAQ,WAAE,EAAY,EAAE,CAAE,GAE1E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,UAAU,EAAE,EAAA,CAAW,UACrC,mBAhB8C,CAAC,UAAE,CAAQ,WAAE,EAAY,EAAE,CAAE,GAE9E,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAW,CAAC,mCAAmC,EAAE,EAAA,CAAW,UAC9D,8BCVD,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAU,CAAV,CAAA,CAAA,CAAA,OAAU,OAAA,EAAiB,SAAW,CAAA,CAAA,AAC1C,CAAC,CAAA,CAAA,CAAA,CAAA,CAAA,CAAQ,CAAA,CAAA,AAAE,EAAG,CAA+B,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,CAAA,AAAK,QAAA,CAAU,CAAA,CAC7D,CAAA,CAAA,qDCfD,IAAA,EAAA,EAAA,CAAA,CAAA,OAEO,eAAe,EAAuB,CAAc,EACvD,GAAI,CACA,QAAQ,GAAG,CAAC,6CAA8C,GAC1D,GAAM,CAAE,KAAM,CAAO,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CAC1C,IAAI,CAAC,YACL,MAAM,CAAC,iDACP,EAAE,CAAC,KAAM,GACT,MAAM,GAEX,GAAI,EAEA,KAFO,CACP,QAAQ,KAAK,CAAC,0BAA2B,GACnC,EAGV,QAAQ,GAAG,CAAC,gBAAiB,GAE7B,IAAM,EAAa,CAAC,CAAC,CACjB,GACA,EAAQ,SAAS,EACjB,EAAQ,WAAW,EACnB,EAAQ,qBAAA,AACZ,EAGA,OADA,QAAQ,GAAG,CAAC,yBAA0B,GAC/B,CACX,CAAE,MAAO,EAAO,CAEZ,OADA,QAAQ,KAAK,CAAC,sCAAuC,IAC9C,CACX,CACJ,gFC5BA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEO,SAAS,EAAe,UAAE,CAAQ,CAAiC,EACxE,GAAM,MAAE,CAAI,SAAE,CAAO,SAAE,CAAO,OAAE,CAAK,gBAAE,CAAc,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IAC3D,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAW,CAAA,EAAA,EAAA,WAAA,AAAW,IACtB,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,SAe7C,CAbA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,QAAQ,GAAG,CAAC,wBAAyB,MAAE,UAAM,EAAS,SAAQ,EAChE,EAAG,CAAC,EAAM,EAAS,EAAQ,EAG3B,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACJ,GAAS,MAAM,IAAM,CAAC,GAAQ,CAAC,GAAW,EAAa,GAAG,CAC5D,QAAQ,GAAG,CAAC,CAAC,4DAA4D,EAAE,EAAa,EAAE,CAAC,CAAC,EAC5F,IACA,EAAc,GAAa,EAAY,GAE3C,EAAG,CAAC,EAAS,EAAM,EAAS,EAAgB,EAAW,EAEnD,GAEA,CAAA,EAAA,EAAA,CAFS,EAET,EAAC,MAAA,CAAI,UAAU,yDACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wBACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,sCAA6B,eAC3C,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yBAAgB,uDAOrC,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACJ,AAAE,CAAD,EAAU,GAAc,AAAD,EAAd,EAAQ,CAAkB,IAAc,AAA3B,CAA4B,EACrD,CADwD,CACjD,IAAI,CAAC,CAAC,YAAY,EAAE,EAAA,CAAU,CAEzC,EAAG,CAAC,EAAM,EAAS,EAAS,EAAY,EAAQ,EAAS,EAErD,AAAE,CAAD,EAAU,GAAa,AAAC,EAAf,EAAQ,CAAkB,IAAb,AAA2B,CAAC,GAAG,AAI1D,QAAQ,GAAG,CAAC,+CACL,CAAA,EAAA,EAAA,GAAA,EAAA,EAAA,QAAA,CAAA,UAAG,KAJD,IAKX,CC7CA,CDwCiB,GCxCjB,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MDsC0D,CChCnD,SAAS,EAAkB,UAAE,CAAQ,CAA0B,EAClE,IAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,CAAE,MAAI,CAAE,CAAG,CAAA,EAAA,EAAA,OAAA,AAAO,IAClB,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,SA+C7C,CA7CA,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KA0CN,CAzC0B,UAEtB,GADA,QAAQ,GAAG,CAAC,mDACR,CAAC,EAAM,CACP,QAAQ,GAAG,CAAC,0DACZ,EAAO,IAAI,CAAC,UACZ,MACJ,CAEA,GAAI,CACA,QAAQ,GAAG,CAAC,mDAAoD,EAAK,EAAE,EACvE,IAAM,EAAa,MAAM,CAAA,EAAA,EAAA,sBAAA,AAAsB,EAAC,EAAK,EAAE,EAGvD,GAFA,CAEI,OAFI,GAAG,CAAC,4CAA6C,GAEpD,EAYD,QAAQ,GAAG,CAAC,6DACZ,GAAc,OAbD,CACb,QAAQ,GAAG,CAAC,oFAEZ,IAAM,EAAc,CAChB,OAAQ,EAAK,EAAE,CACf,MAAO,EAAK,KAAK,CACjB,MAAO,EAAK,KAAK,EAAI,EACzB,EACA,QAAQ,GAAG,CAAC,2CAA4C,GACxD,aAAa,OAAO,CAAC,sBAAuB,KAAK,SAAS,CAAC,IAC3D,EAAO,IAAI,CAAC,yBAChB,CAIJ,CAAE,KAJS,CAIF,EAAO,CACZ,QAAQ,KAAK,CAAC,kDAAmD,GAEjE,IAAM,EAAc,CAChB,OAAQ,EAAK,EAAE,CACf,MAAO,EAAK,KAAK,CACjB,MAAO,EAAK,KAAK,EAAI,EACzB,EACA,aAAa,OAAO,CAAC,sBAAuB,KAAK,SAAS,CAAC,IAC3D,EAAO,IAAI,CAAC,yBAChB,EACJ,GAGJ,EAAG,CAAC,EAAM,EAAO,EAEb,GAEI,CAAA,EAAA,EAAA,GAAA,CAFQ,CAEP,MAAA,CAAI,UAAU,4BACX,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,IAAI,CAAA,UACD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,UAAU,6BAChB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,sCAA6B,qBAC3C,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CAAC,UAAU,yDAOhC,CAAA,EAAA,EAAA,GAAA,EAAA,EAAA,QAAA,CAAA,UAAG,GACd,CCvEe,SAAS,EAAgB,UACpC,CAAQ,CAGX,EACG,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UACG,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UACI,KAIjB","ignoreList":[0,1,3]}