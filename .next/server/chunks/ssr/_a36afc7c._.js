module.exports=[33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},24987,a=>{"use strict";let b=(0,a.i(70106).default)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],24987)},32245,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=a.r(41997);function e({reason:a,children:b}){throw Object.defineProperty(new d.BailoutToCSRError(a),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},7773,(a,b,c)=>{"use strict";function d(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"encodeURIPath",{enumerable:!0,get:function(){return d}})},97458,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=a.r(87924),e=a.r(35112),f=a.r(56704),g=a.r(7773);function h({moduleIds:a}){let b=f.workAsyncStorage.getStore();if(void 0===b)return null;let c=[];if(b.reactLoadableManifest&&a){let d=b.reactLoadableManifest;for(let b of a){if(!d[b])continue;let a=d[b].files;c.push(...a)}}return 0===c.length?null:(0,d.jsx)(d.Fragment,{children:c.map(a=>{let c=`${b.assetPrefix}/_next/${(0,g.encodeURIPath)(a)}`;return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:c,rel:"stylesheet",as:"style",nonce:b.nonce},a):((0,e.preload)(c,{as:"script",fetchPriority:"low",nonce:b.nonce}),null)})})}},69853,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return j}});let d=a.r(87924),e=a.r(72131),f=a.r(32245),g=a.r(97458);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},19721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return e}});let d=a.r(33354)._(a.r(69853));function e(a,b){let c={};"function"==typeof a&&(c.loader=a);let e={...c,...b};return(0,d.default)({...e,modules:e.loadableGenerated?.modules})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},87532,a=>{"use strict";let b=(0,a.i(70106).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);a.s(["Search",()=>b],87532)},39093,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(19721),e=a.i(78560),f=a.i(12466),g=a.i(24987);let h=(0,a.i(70106).default)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var i=a.i(87532),j=a.i(24452),k=a.i(53131);function l(){return(0,b.jsxs)("div",{className:"space-y-6 h-[calc(100vh-140px)] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"h-8 w-48 bg-gray-200 rounded-md animate-pulse mb-2"}),(0,b.jsx)("div",{className:"h-4 w-32 bg-gray-200 rounded-md animate-pulse"})]}),(0,b.jsx)("div",{className:"h-10 w-40 bg-gray-200 rounded-md animate-pulse"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow min-h-0",children:[(0,b.jsx)("div",{className:"lg:col-span-8 h-[400px] lg:h-full rounded-2xl border border-gray-200 shadow-sm bg-gray-100 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,b.jsx)("div",{className:"h-12 w-12 border-4 border-gray-300 border-t-primary-300 rounded-full animate-spin"}),(0,b.jsx)("div",{className:"text-gray-400 font-medium animate-pulse",children:"Locating donors..."})]})}),(0,b.jsxs)("div",{className:"lg:col-span-4 flex flex-col h-full min-h-0 bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-100 flex justify-between items-center",children:[(0,b.jsx)("div",{className:"h-6 w-32 bg-gray-200 rounded-md animate-pulse"}),(0,b.jsx)("div",{className:"h-6 w-16 bg-gray-200 rounded-full animate-pulse"})]}),(0,b.jsx)("div",{className:"p-4 space-y-3 custom-scrollbar flex-grow overflow-y-auto",children:[1,2,3,4,5,6].map(a=>(0,b.jsxs)("div",{className:"flex items-center p-3 rounded-xl border border-gray-100",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-200 animate-pulse flex-shrink-0"}),(0,b.jsxs)("div",{className:"ml-3 flex-grow space-y-2",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"h-4 w-24 bg-gray-200 rounded animate-pulse"}),(0,b.jsx)("div",{className:"h-5 w-8 bg-gray-200 rounded animate-pulse"})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("div",{className:"h-3 w-16 bg-gray-200 rounded animate-pulse"}),(0,b.jsx)("div",{className:"h-3 w-12 bg-gray-200 rounded animate-pulse"})]})]})]},a))})]})]})]})}let m=(0,d.default)(async()=>{},{loadableGenerated:{modules:[5481]},ssr:!1,loading:()=>(0,b.jsx)("div",{className:"h-full w-full bg-gray-100 animate-pulse rounded-xl flex items-center justify-center text-gray-400",children:"Loading Map..."})});function n(){let{user:a}=(0,k.useAuth)(),[d,n]=(0,c.useState)({lat:20.5937,lng:78.9629}),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)(!0),[u,v]=(0,c.useState)(""),[w,x]=(0,c.useState)(""),[y,z]=(0,c.useState)({});(0,c.useEffect)(()=>{(async()=>{try{let{data:a,error:b}=await e.supabase.from("profiles").select("id, full_name, blood_group, location, present_zip").eq("is_donor",!0);if(b)throw b;let c=a?.map(a=>({...a,location:"string"==typeof a.location?JSON.parse(a.location):a.location}))||[],d=new Set;c.forEach(a=>{(!a.location?.latitude||0===a.location.latitude)&&a.present_zip&&d.add(a.present_zip)});let f={...y},g=!1;for(let a of Array.from(d).slice(0,5))if(!f[a])try{let b=await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${a}&country=India&format=json&limit=1`,{headers:{"User-Agent":"VitalBloodApp/1.0"}}),c=await b.json();c&&c.length>0&&(f[a]={lat:parseFloat(c[0].lat),lng:parseFloat(c[0].lon)},g=!0,await new Promise(a=>setTimeout(a,800)))}catch(b){console.error(`Failed to geocode zip ${a}`,b)}g&&z(f);let h=c.map(a=>(!a.location?.latitude||0===a.location.latitude)&&a.present_zip&&f[a.present_zip]?{...a,location:{...a.location,latitude:f[a.present_zip].lat,longitude:f[a.present_zip].lng,address:a.location?.address||`Zip: ${a.present_zip}`}}:a);p(h)}catch(a){console.error("Error fetching donors",a),v(a.message)}finally{t(!1)}})()},[]);let A=(0,c.useCallback)(()=>{if(x("Locating..."),!("geolocation"in navigator)){v("Geolocation not supported by your browser."),x("");return}navigator.geolocation.getCurrentPosition(a=>{n({lat:a.coords.latitude,lng:a.coords.longitude}),x("")},a=>{v("Unable to get your location: "+a.message),x("")},{enableHighAccuracy:!0,timeout:1e4})},[]);return((0,c.useEffect)(()=>{r(o.filter(b=>b.id!==a?.id&&b.location&&void 0!==b.location.latitude&&null!==b.location.latitude&&void 0!==b.location.longitude&&null!==b.location.longitude).map(a=>{var b,c,e,f;let g,h,i,j,k=(b=d.lat,c=d.lng,e=a.location.latitude,f=a.location.longitude,h=(g=a=>a*Math.PI/180)(e-b),i=g(f-c),2*Math.atan2(Math.sqrt(j=Math.sin(h/2)**2+Math.cos(g(b))*Math.cos(g(e))*Math.sin(i/2)**2),Math.sqrt(1-j))*6371);return{...a,distanceKm:k}}).sort((a,b)=>(a.distanceKm||0)-(b.distanceKm||0)).slice(0,20))},[d,o,a]),s)?(0,b.jsx)(l,{}):(0,b.jsxs)("div",{className:"space-y-6 h-[calc(100vh-140px)] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Find Donors Nearby"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"Discover life-savers in your vicinity"})]}),(0,b.jsx)(f.Button,{onClick:A,leftIcon:w?(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):(0,b.jsx)(h,{className:"h-4 w-4"}),disabled:!!w,className:"shadow-sm transition-all hover:shadow-md active:scale-95",children:w||"Use My Location"})]}),u&&(0,b.jsx)(j.Alert,{variant:"error",className:"flex-shrink-0",children:u}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow min-h-0",children:[(0,b.jsx)("div",{className:"lg:col-span-8 h-[400px] lg:h-full rounded-2xl overflow-hidden border border-gray-200 shadow-sm relative group bg-gray-50",children:(0,b.jsx)(m,{center:d,zoom:11,markers:[{position:d,title:"You are here"},...q.map(a=>({position:{lat:a.location.latitude,lng:a.location.longitude},title:a.full_name,description:`${a.blood_group} | ${a.distanceKm?.toFixed(1)} km away`}))]})}),(0,b.jsxs)("div",{className:"lg:col-span-4 flex flex-col h-full min-h-0 bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[(0,b.jsxs)("h2",{className:"font-semibold text-gray-800 flex items-center",children:[(0,b.jsx)(i.Search,{className:"w-4 h-4 mr-2 text-gray-400"}),"Closest Donors"]}),(0,b.jsxs)("span",{className:"bg-white text-gray-600 px-2 py-0.5 rounded-full text-xs font-medium border border-gray-200",children:[q.length," found"]})]}),(0,b.jsx)("div",{className:"overflow-y-auto p-4 space-y-3 custom-scrollbar flex-grow",children:0===q.length?(0,b.jsxs)("div",{className:"text-center py-12 flex flex-col items-center justify-center opacity-60",children:[(0,b.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-3",children:(0,b.jsx)(g.MapPin,{className:"h-8 w-8 text-gray-400"})}),(0,b.jsx)("p",{className:"text-gray-900 font-medium",children:"No donors found nearby"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1 max-w-[200px]",children:"Try using your current location or expanding your search area."})]}):q.map(a=>(0,b.jsxs)("div",{onClick:()=>n({lat:a.location.latitude,lng:a.location.longitude}),className:"group flex items-center p-3 rounded-xl border border-gray-100 hover:border-primary-100 hover:bg-primary-50/30 transition-all duration-200 cursor-pointer",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-500 font-bold text-lg shadow-inner flex-shrink-0",children:a.full_name.split(" ").map(a=>a[0]).slice(0,2).join("").toUpperCase()}),(0,b.jsxs)("div",{className:"ml-3 flex-grow min-w-0",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 truncate pr-2",children:a.full_name}),(0,b.jsx)("span",{className:`text-xs font-bold px-2 py-0.5 rounded border ${a.blood_group.includes("+")?"bg-rose-100 text-rose-700 border-rose-200":"bg-indigo-100 text-indigo-700 border-indigo-200"}`,children:a.blood_group})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,b.jsx)("div",{className:"flex items-center text-xs text-gray-500",children:a.present_zip?(0,b.jsx)("span",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 font-mono",children:a.present_zip}):(0,b.jsx)("span",{className:"text-gray-400 italic",children:"Zip N/A"})}),(0,b.jsxs)("div",{className:"text-xs font-medium text-gray-500 flex items-center",children:[(0,b.jsx)(g.MapPin,{className:"w-3 h-3 mr-1 text-gray-400"}),a.distanceKm?.toFixed(1)," km"]})]})]})]},a.id))})]})]})]})}a.s(["default",()=>n],39093)}];

//# sourceMappingURL=_a36afc7c._.js.map