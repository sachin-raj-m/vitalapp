module.exports=[35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},95756,a=>{"use strict";let b=(0,a.i(70106).default)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);a.s(["CheckCircle",()=>b],95756)},24452,90821,a=>{"use strict";var b=a.i(87924),c=a.i(70106);let d=(0,c.default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>d],90821);var e=a.i(95756);let f=(0,c.default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var g=a.i(33508);a.s(["Alert",0,({title:a,children:c,variant:h="info",onClose:i,className:j=""})=>{let k={info:(0,b.jsx)(f,{className:"h-5 w-5 text-blue-400"}),success:(0,b.jsx)(e.CheckCircle,{className:"h-5 w-5 text-green-400"}),warning:(0,b.jsx)(d,{className:"h-5 w-5 text-yellow-400"}),error:(0,b.jsx)(d,{className:"h-5 w-5 text-red-400"})},l=`
    rounded-md p-4
    ${{info:"bg-blue-50 text-blue-800",success:"bg-green-50 text-green-800",warning:"bg-yellow-50 text-yellow-800",error:"bg-red-50 text-red-800"}[h]}
    ${j}
  `;return(0,b.jsx)("div",{className:l,children:(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:k[h]}),(0,b.jsxs)("div",{className:"ml-3 flex-1",children:[a&&(0,b.jsx)("h3",{className:"text-sm font-medium",children:a}),(0,b.jsx)("div",{className:`text-sm ${a?"mt-2":""}`,children:c})]}),i&&(0,b.jsx)("div",{className:"ml-auto pl-3",children:(0,b.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,b.jsxs)("button",{type:"button",onClick:i,className:`
                  inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2
                  ${"info"===h?"text-blue-500 hover:bg-blue-100 focus:ring-blue-600":""}
                  ${"success"===h?"text-green-500 hover:bg-green-100 focus:ring-green-600":""}
                  ${"warning"===h?"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600":""}
                  ${"error"===h?"text-red-500 hover:bg-red-100 focus:ring-red-600":""}
                `,children:[(0,b.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,b.jsx)(g.X,{className:"h-5 w-5"})]})})})]})})}],24452)},18180,a=>{"use strict";var b=a.i(87924);a.s(["Input",0,({label:a,error:c,helperText:d,className:e="",...f})=>{let g=f.id||f.name||Math.random().toString(36).substring(2,9);return(0,b.jsxs)("div",{className:"mb-4",children:[a&&(0,b.jsx)("label",{htmlFor:g,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("input",{id:g,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${c?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${e}
        `,...f}),c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-error-500",children:c}),d&&!c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})},"Select",0,({label:a,error:c,helperText:d,options:e,className:f="",...g})=>{let h=g.id||g.name||Math.random().toString(36).substring(2,9);return(0,b.jsxs)("div",{className:"mb-4",children:[a&&(0,b.jsx)("label",{htmlFor:h,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("select",{id:h,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${c?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${f}
        `,...g,children:e.map(a=>(0,b.jsx)("option",{value:a.value,children:a.label},a.value))}),c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-error-500",children:c}),d&&!c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})},"Textarea",0,({label:a,error:c,helperText:d,className:e="",...f})=>{let g=f.id||f.name||Math.random().toString(36).substring(2,9);return(0,b.jsxs)("div",{className:"mb-4",children:[a&&(0,b.jsx)("label",{htmlFor:g,className:"block text-sm font-medium text-gray-700 mb-1",children:a}),(0,b.jsx)("textarea",{id:g,className:`
          w-full px-3 py-2 border rounded-md shadow-sm placeholder-gray-400 
          focus:outline-none focus:ring-2 
          ${c?"border-error-300 focus:border-error-500 focus:ring-error-500":"border-gray-300 focus:border-secondary-500 focus:ring-secondary-500"}
          ${e}
        `,...f}),c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-error-500",children:c}),d&&!c&&(0,b.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:d})]})}])},88736,a=>{"use strict";var b=a.i(87924),c=a.i(33508);a.s(["Modal",0,({isOpen:a,onClose:d,title:e,children:f})=>a?(0,b.jsx)("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:(0,b.jsxs)("div",{className:"flex min-h-screen items-center justify-center p-4 text-center sm:p-0",children:[(0,b.jsx)("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:d}),(0,b.jsx)("div",{className:"relative transform overflow-hidden rounded-lg bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",children:(0,b.jsxs)("div",{className:"bg-white px-4 pb-4 pt-5 sm:p-6 sm:pb-4",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsx)("h3",{className:"text-lg font-medium leading-6 text-gray-900",id:"modal-title",children:e}),(0,b.jsxs)("button",{type:"button",className:"ml-4 inline-flex flex-shrink-0 items-center justify-center rounded-md bg-white text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",onClick:d,children:[(0,b.jsx)("span",{className:"sr-only",children:"Close"}),(0,b.jsx)(c.X,{className:"h-5 w-5","aria-hidden":"true"})]})]}),(0,b.jsx)("div",{className:"mt-2 text-sm text-gray-500",children:f})]})})]})}):null])},67551,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(34904),e=a.i(34048),f=a.i(12466),g=a.i(18180),h=a.i(88736),i=a.i(24452),j=a.i(53131),k=a.i(78560),l=a.i(26017),m=a.i(95756);function n(){let{user:a}=(0,j.useAuth)(),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(""),[t,u]=(0,c.useState)("active"),v=n.filter(a=>"active"===t?"active"===a.status:"fulfilled"===a.status||"cancelled"===a.status),[w,x]=(0,c.useState)({isOpen:!1,donationId:"",requestId:"",donorName:"",maxUnits:0}),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(1),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)("");(0,c.useEffect)(()=>{G()},[a]);let G=async()=>{if(a)try{let{data:b,error:c}=await k.supabase.from("blood_requests").select(`
                    *,
                    donations:donations(
                        *,
                        profiles(full_name, phone)
                    )
                `).eq("user_id",a.id).order("created_at",{ascending:!1});if(c)throw c;o(b)}catch(a){console.error("Error fetching requests"),s("Failed to load your requests")}finally{q(!1)}},H=async()=>{D(!0),F("");try{let{data:a,error:b}=await k.supabase.from("donations").select("otp, request_id").eq("id",w.donationId).single();if(b)throw b;if(a.otp===y){let{error:a}=await k.supabase.from("donations").update({status:"completed",units_donated:A}).eq("id",w.donationId);if(a)throw a;let{data:b,error:c}=await k.supabase.from("donations").select("units_donated").eq("request_id",w.requestId).eq("status","completed");if(c)throw c;let d=b.reduce((a,b)=>a+(b.units_donated||0),0),e=n.find(a=>a.id===w.requestId),f=e?.units_needed||0,g="Donation verified successfully!";if(d>=f){let{error:a}=await k.supabase.from("blood_requests").update({status:"fulfilled"}).eq("id",w.requestId);if(a)throw a;g+=" Request has been fulfilled and closed."}else g+=` Progress: ${d}/${f} units.`;await G(),x({isOpen:!1,donationId:"",requestId:"",donorName:"",maxUnits:0}),z(""),B(1),alert(g)}else F("Invalid PIN. Please ask the donor for their correct PIN.")}catch(a){console.error("Verification error",a),F(a.message||"Verification failed")}finally{D(!1)}};return p?(0,b.jsx)("div",{className:"flex justify-center items-center min-h-[60vh]",children:(0,b.jsx)(l.Loader2,{className:"h-8 w-8 animate-spin text-primary-500"})}):(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"My Requests"}),r&&(0,b.jsx)(i.Alert,{variant:"error",children:r}),(0,b.jsxs)("div",{className:"flex space-x-1 bg-gray-100 p-1 rounded-lg w-fit",children:[(0,b.jsx)("button",{onClick:()=>u("active"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"active"===t?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Active Requests"}),(0,b.jsx)("button",{onClick:()=>u("past"),className:`px-4 py-2 text-sm font-medium rounded-md transition-all ${"past"===t?"bg-white text-gray-900 shadow-sm":"text-gray-500 hover:text-gray-700"}`,children:"Past Requests"})]}),0===v.length?(0,b.jsxs)("div",{className:"text-center py-12 bg-white rounded-lg shadow",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"active"===t?"You don't have any active blood requests.":"No past requests found."}),"active"===t&&(0,b.jsx)(f.Button,{onClick:()=>window.location.href="/requests/new",children:"Create Request"})]}):(0,b.jsx)("div",{className:"space-y-6",children:v.map(a=>(0,b.jsxs)(d.Card,{children:[(0,b.jsx)(d.CardHeader,{children:(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start gap-2",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h3",{className:"text-lg font-bold text-gray-900",children:[a.blood_group," Blood Needed"]}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:a.hospital_name}),(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:new Date(a.created_at).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"flex flex-col items-end gap-1 self-end md:self-auto",children:[(0,b.jsx)(e.Badge,{variant:"active"===a.status?"warning":"success",children:a.status.charAt(0).toUpperCase()+a.status.slice(1)}),"active"===a.status&&(0,b.jsxs)("div",{className:"w-32 mt-1",children:[(0,b.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 mb-1",children:[(0,b.jsx)("span",{children:"Collected"}),(0,b.jsxs)("span",{children:[a.donations.filter(a=>"completed"===a.status).reduce((a,b)=>a+(b.units_donated||0),0)," / ",a.units_needed]})]}),(0,b.jsx)("div",{className:"h-1.5 w-full bg-gray-100 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-green-500 rounded-full",style:{width:`${Math.min(100,a.donations.filter(a=>"completed"===a.status).reduce((a,b)=>a+(b.units_donated||0),0)/a.units_needed*100)}%`}})})]})]})]})}),(0,b.jsxs)(d.CardBody,{children:[(0,b.jsx)("h4",{className:"font-medium text-gray-900 mb-3",children:"Donation Offers"}),a.donations&&a.donations.length>0?(0,b.jsx)("div",{className:"space-y-3",children:a.donations.map(c=>(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-100 gap-3",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-600 font-bold",children:c.profiles?.full_name?.charAt(0)||"D"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:c.profiles?.full_name||"Anonymous"}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:c.profiles?.phone})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-2",children:"pending"===c.status?(0,b.jsx)(f.Button,{size:"sm",onClick:()=>x({isOpen:!0,donationId:c.id,requestId:a.id,donorName:c.profiles?.full_name,maxUnits:a.units_needed-a.donations.filter(a=>"completed"===a.status).reduce((a,b)=>a+(b.units_donated||0),0)}),children:"Verify PIN"}):(0,b.jsxs)("span",{className:"flex items-center text-green-600 text-sm font-medium",children:[(0,b.jsx)(m.CheckCircle,{className:"h-4 w-4 mr-1"})," ",c.units_donated||1," Unit(s) Verified"]})})]},c.id))}):(0,b.jsx)("p",{className:"text-gray-500 text-sm italic",children:"No offers yet."})]})]},a.id))}),(0,b.jsx)(h.Modal,{isOpen:w.isOpen,onClose:()=>x({...w,isOpen:!1}),title:`Verify Donation from ${w.donorName}`,children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("p",{className:"text-sm text-gray-600",children:["Ask the donor for their ",(0,b.jsx)("strong",{children:"4-digit Donor PIN"})," and enter it below to confirm the donation.",(0,b.jsx)("br",{}),(0,b.jsx)("span",{className:"text-xs text-orange-600 font-medium mt-1 block",children:"Note: verifying this will mark the request as fulfilled."})]}),(0,b.jsx)(g.Input,{label:"Enter Donor PIN",placeholder:"e.g. 1234",value:y,onChange:a=>z(a.target.value),maxLength:4,className:"text-center text-2xl tracking-widest"}),(0,b.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-blue-900 mb-2",children:"Units Donated"}),(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("button",{className:"w-10 h-10 rounded-md bg-white border border-blue-200 text-blue-600 font-bold hover:bg-blue-100",onClick:()=>B(Math.max(1,A-1)),children:"-"}),(0,b.jsx)("span",{className:"text-xl font-bold text-gray-800 w-8 text-center",children:A}),(0,b.jsx)("button",{className:"w-10 h-10 rounded-md bg-white border border-blue-200 text-blue-600 font-bold hover:bg-blue-100",onClick:()=>B(A+1),children:"+"})]}),(0,b.jsx)("p",{className:"text-xs text-blue-600 mt-2",children:"Confirm the number of blood units collected from this donor."})]}),E&&(0,b.jsx)("p",{className:"text-red-500 text-sm",children:E}),(0,b.jsxs)("div",{className:"flex justify-end gap-3 pt-2",children:[(0,b.jsx)(f.Button,{variant:"secondary",onClick:()=>x({...w,isOpen:!1}),children:"Cancel"}),(0,b.jsx)(f.Button,{onClick:H,isLoading:C,disabled:4!==y.length,children:"Verify & Complete"})]})]})})]})}a.s(["MyRequestsContent",()=>n])}];

//# sourceMappingURL=_c81ca991._.js.map