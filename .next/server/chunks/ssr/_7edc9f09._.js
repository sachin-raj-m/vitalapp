module.exports=[35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},24452,90821,a=>{"use strict";var b=a.i(87924);let c=(0,a.i(70106).default)("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);a.s(["AlertCircle",()=>c],90821);var d=a.i(95756),e=a.i(97063),f=a.i(33508);a.s(["Alert",0,({title:a,children:g,variant:h="info",onClose:i,className:j=""})=>{let k={info:(0,b.jsx)(e.Info,{className:"h-5 w-5 text-blue-400"}),success:(0,b.jsx)(d.CheckCircle,{className:"h-5 w-5 text-green-400"}),warning:(0,b.jsx)(c,{className:"h-5 w-5 text-yellow-400"}),error:(0,b.jsx)(c,{className:"h-5 w-5 text-red-400"})},l=`
    rounded-md p-4
    ${{info:"bg-blue-50 text-blue-800",success:"bg-green-50 text-green-800",warning:"bg-yellow-50 text-yellow-800",error:"bg-red-50 text-red-800"}[h]}
    ${j}
  `;return(0,b.jsx)("div",{className:l,children:(0,b.jsxs)("div",{className:"flex",children:[(0,b.jsx)("div",{className:"flex-shrink-0",children:k[h]}),(0,b.jsxs)("div",{className:"ml-3 flex-1",children:[a&&(0,b.jsx)("h3",{className:"text-sm font-medium",children:a}),(0,b.jsx)("div",{className:`text-sm ${a?"mt-2":""}`,children:g})]}),i&&(0,b.jsx)("div",{className:"ml-auto pl-3",children:(0,b.jsx)("div",{className:"-mx-1.5 -my-1.5",children:(0,b.jsxs)("button",{type:"button",onClick:i,className:`
                  inline-flex rounded-md p-1.5 focus:outline-none focus:ring-2 focus:ring-offset-2
                  ${"info"===h?"text-blue-500 hover:bg-blue-100 focus:ring-blue-600":""}
                  ${"success"===h?"text-green-500 hover:bg-green-100 focus:ring-green-600":""}
                  ${"warning"===h?"text-yellow-500 hover:bg-yellow-100 focus:ring-yellow-600":""}
                  ${"error"===h?"text-red-500 hover:bg-red-100 focus:ring-red-600":""}
                `,children:[(0,b.jsx)("span",{className:"sr-only",children:"Dismiss"}),(0,b.jsx)(f.X,{className:"h-5 w-5"})]})})})]})})}],24452)},33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},24987,a=>{"use strict";let b=(0,a.i(70106).default)("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);a.s(["MapPin",()=>b],24987)},32245,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=a.r(41997);function e({reason:a,children:b}){throw Object.defineProperty(new d.BailoutToCSRError(a),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},7773,(a,b,c)=>{"use strict";function d(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"encodeURIPath",{enumerable:!0,get:function(){return d}})},97458,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=a.r(87924),e=a.r(35112),f=a.r(56704),g=a.r(7773);function h({moduleIds:a}){let b=f.workAsyncStorage.getStore();if(void 0===b)return null;let c=[];if(b.reactLoadableManifest&&a){let d=b.reactLoadableManifest;for(let b of a){if(!d[b])continue;let a=d[b].files;c.push(...a)}}return 0===c.length?null:(0,d.jsx)(d.Fragment,{children:c.map(a=>{let c=`${b.assetPrefix}/_next/${(0,g.encodeURIPath)(a)}`;return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:c,rel:"stylesheet",as:"style",nonce:b.nonce},a):((0,e.preload)(c,{as:"script",fetchPriority:"low",nonce:b.nonce}),null)})})}},69853,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return j}});let d=a.r(87924),e=a.r(72131),f=a.r(32245),g=a.r(97458);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},19721,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return e}});let d=a.r(33354)._(a.r(69853));function e(a,b){let c={};"function"==typeof a&&(c.loader=a);let e={...c,...b};return(0,d.default)({...e,modules:e.loadableGenerated?.modules})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},87532,a=>{"use strict";let b=(0,a.i(70106).default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);a.s(["Search",()=>b],87532)},39093,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(19721),e=a.i(78560),f=a.i(12466),g=a.i(24987);let h=(0,a.i(70106).default)("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);var i=a.i(87532),j=a.i(24452),k=a.i(53131);let l=(0,d.default)(async()=>{},{loadableGenerated:{modules:[5481]},ssr:!1,loading:()=>(0,b.jsx)("div",{className:"h-full w-full bg-gray-100 animate-pulse rounded-xl flex items-center justify-center text-gray-400",children:"Loading Map..."})});function m(){let{user:a}=(0,k.useAuth)(),[d,m]=(0,c.useState)({lat:20.5937,lng:78.9629}),[n,o]=(0,c.useState)([]),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)({});(0,c.useEffect)(()=>{(async()=>{try{let{data:a,error:b}=await e.supabase.from("profiles").select("id, full_name, blood_group, location, present_zip").eq("is_donor",!0);if(b)throw b;let c=a?.map(a=>({...a,location:"string"==typeof a.location?JSON.parse(a.location):a.location}))||[],d=new Set;c.forEach(a=>{(!a.location?.latitude||0===a.location.latitude)&&a.present_zip&&d.add(a.present_zip)});let f={...x},g=!1;for(let a of Array.from(d).slice(0,5))if(!f[a])try{let b=await fetch(`https://nominatim.openstreetmap.org/search?postalcode=${a}&country=India&format=json&limit=1`,{headers:{"User-Agent":"VitalBloodApp/1.0"}}),c=await b.json();c&&c.length>0&&(f[a]={lat:parseFloat(c[0].lat),lng:parseFloat(c[0].lon)},g=!0,await new Promise(a=>setTimeout(a,800)))}catch(b){console.error(`Failed to geocode zip ${a}`,b)}g&&y(f);let h=c.map(a=>(!a.location?.latitude||0===a.location.latitude)&&a.present_zip&&f[a.present_zip]?{...a,location:{...a.location,latitude:f[a.present_zip].lat,longitude:f[a.present_zip].lng,address:a.location?.address||`Zip: ${a.present_zip}`}}:a);o(h)}catch(a){console.error("Error fetching donors",a),u(a.message)}finally{s(!1)}})()},[]);let z=(0,c.useCallback)(()=>{if(w("Locating..."),!("geolocation"in navigator)){u("Geolocation not supported by your browser."),w("");return}navigator.geolocation.getCurrentPosition(a=>{m({lat:a.coords.latitude,lng:a.coords.longitude}),w("")},a=>{u("Unable to get your location: "+a.message),w("")},{enableHighAccuracy:!0,timeout:1e4})},[]);return(0,c.useEffect)(()=>{q(n.filter(b=>b.id!==a?.id&&b.location&&void 0!==b.location.latitude&&null!==b.location.latitude&&void 0!==b.location.longitude&&null!==b.location.longitude).map(a=>{var b,c,e,f;let g,h,i,j,k=(b=d.lat,c=d.lng,e=a.location.latitude,f=a.location.longitude,h=(g=a=>a*Math.PI/180)(e-b),i=g(f-c),2*Math.atan2(Math.sqrt(j=Math.sin(h/2)**2+Math.cos(g(b))*Math.cos(g(e))*Math.sin(i/2)**2),Math.sqrt(1-j))*6371);return{...a,distanceKm:k}}).sort((a,b)=>(a.distanceKm||0)-(b.distanceKm||0)).slice(0,20))},[d,n,a]),(0,b.jsxs)("div",{className:"space-y-6 h-[calc(100vh-140px)] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 flex-shrink-0",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Find Donors Nearby"}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"Discover life-savers in your vicinity"})]}),(0,b.jsx)(f.Button,{onClick:z,leftIcon:v?(0,b.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}):(0,b.jsx)(h,{className:"h-4 w-4"}),disabled:!!v,className:"shadow-sm transition-all hover:shadow-md active:scale-95",children:v||"Use My Location"})]}),t&&(0,b.jsx)(j.Alert,{variant:"error",className:"flex-shrink-0",children:t}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6 flex-grow min-h-0",children:[(0,b.jsx)("div",{className:"lg:col-span-8 h-[400px] lg:h-full rounded-2xl overflow-hidden border border-gray-200 shadow-sm relative group bg-gray-50",children:(0,b.jsx)(l,{center:d,zoom:11,markers:[{position:d,title:"You are here"},...p.map(a=>({position:{lat:a.location.latitude,lng:a.location.longitude},title:a.full_name,description:`${a.blood_group} | ${a.distanceKm?.toFixed(1)} km away`}))]})}),(0,b.jsxs)("div",{className:"lg:col-span-4 flex flex-col h-full min-h-0 bg-white rounded-2xl border border-gray-200 shadow-sm overflow-hidden",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-100 bg-gray-50/50 flex justify-between items-center",children:[(0,b.jsxs)("h2",{className:"font-semibold text-gray-800 flex items-center",children:[(0,b.jsx)(i.Search,{className:"w-4 h-4 mr-2 text-gray-400"}),"Closest Donors"]}),(0,b.jsxs)("span",{className:"bg-white text-gray-600 px-2 py-0.5 rounded-full text-xs font-medium border border-gray-200",children:[p.length," found"]})]}),(0,b.jsx)("div",{className:"overflow-y-auto p-4 space-y-3 custom-scrollbar flex-grow",children:0===p.length?(0,b.jsxs)("div",{className:"text-center py-12 flex flex-col items-center justify-center opacity-60",children:[(0,b.jsx)("div",{className:"bg-gray-100 p-4 rounded-full mb-3",children:(0,b.jsx)(g.MapPin,{className:"h-8 w-8 text-gray-400"})}),(0,b.jsx)("p",{className:"text-gray-900 font-medium",children:"No donors found nearby"}),(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1 max-w-[200px]",children:"Try using your current location or expanding your search area."})]}):p.map(a=>(0,b.jsxs)("div",{onClick:()=>m({lat:a.location.latitude,lng:a.location.longitude}),className:"group flex items-center p-3 rounded-xl border border-gray-100 hover:border-primary-100 hover:bg-primary-50/30 transition-all duration-200 cursor-pointer",children:[(0,b.jsx)("div",{className:"h-12 w-12 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center text-gray-500 font-bold text-lg shadow-inner flex-shrink-0",children:a.full_name.split(" ").map(a=>a[0]).slice(0,2).join("").toUpperCase()}),(0,b.jsxs)("div",{className:"ml-3 flex-grow min-w-0",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900 truncate pr-2",children:a.full_name}),(0,b.jsx)("span",{className:`text-xs font-bold px-2 py-0.5 rounded border ${a.blood_group.includes("+")?"bg-rose-100 text-rose-700 border-rose-200":"bg-indigo-100 text-indigo-700 border-indigo-200"}`,children:a.blood_group})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between mt-1",children:[(0,b.jsx)("div",{className:"flex items-center text-xs text-gray-500",children:a.present_zip?(0,b.jsx)("span",{className:"bg-gray-100 px-1.5 py-0.5 rounded text-gray-600 font-mono",children:a.present_zip}):(0,b.jsx)("span",{className:"text-gray-400 italic",children:"Zip N/A"})}),(0,b.jsxs)("div",{className:"text-xs font-medium text-gray-500 flex items-center",children:[(0,b.jsx)(g.MapPin,{className:"w-3 h-3 mr-1 text-gray-400"}),a.distanceKm?.toFixed(1)," km"]})]})]})]},a.id))})]})]})]})}a.s(["default",()=>m],39093)}];

//# sourceMappingURL=_7edc9f09._.js.map