module.exports=[34904,a=>{"use strict";var b=a.i(87924);a.s(["Card",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`bg-white rounded-lg shadow-md overflow-hidden ${c}`,children:a}),"CardBody",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 ${c}`,children:a}),"CardHeader",0,({children:a,className:c=""})=>(0,b.jsx)("div",{className:`px-6 py-4 border-b border-gray-200 ${c}`,children:a})])},26017,a=>{"use strict";let b=(0,a.i(70106).default)("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],26017)},61730,a=>{"use strict";var b=a.i(78560);async function c(a){try{let{data:c,error:d}=await b.supabase.from("profiles").select("full_name, blood_group, blood_group_proof_url").eq("id",a).single();if(d)throw console.error("Error fetching profile:",d),d;return!!(c&&c.full_name&&c.blood_group&&c.blood_group_proof_url)}catch(a){return console.error("Error checking registration status:",a),!1}}a.s(["isRegistrationComplete",()=>c])},4879,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(34904),f=a.i(18180),g=a.i(24452),h=a.i(12466),i=a.i(78560),j=a.i(26017),k=a.i(53131),l=a.i(61730);function m(){let a=(0,d.useRouter)(),{user:m}=(0,k.useAuth)(),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)("loading"),[r,s]=(0,c.useState)(0),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)({fullName:"",phone:"",bloodGroup:"",proofType:"",proofFile:null,permanentZip:"",presentZip:""}),[x,y]=(0,c.useState)({});(0,c.useEffect)(()=>{let b=async()=>{console.log("Initializing CompleteRegistration page");try{if(!m){console.log("No user found, redirecting to login"),a.push("/login");return}console.log("Current user:",m);let b=await (0,l.isRegistrationComplete)(m.id);if(console.log("Registration status:",b),b){console.log("Registration already complete, redirecting to dashboard"),a.push("/dashboard");return}let c=localStorage.getItem("pendingRegistration");if(console.log("Stored registration data:",c),!c){console.log("No pending registration data found"),o("Registration data not found. Please register again."),a.push("/register");return}try{let a=JSON.parse(c);if(console.log("Parsed registration data:",a),a.userId!==m.id)throw console.log("User ID mismatch:",{stored:a.userId,current:m.id}),Error("User ID mismatch");u(a),a.phone&&w(b=>({...b,phone:a.phone})),q("form")}catch(a){throw console.error("Error processing stored data:",a),Error("Invalid registration data")}}catch(b){console.error("Initialization error:",b),o(b.message||"Failed to load registration data"),a.push("/register")}};void 0!==m&&b()},[a,m]);let z=async b=>{let c;if(b.preventDefault(),c={},v.fullName.trim()||(c.fullName="Full name is required"),v.phone.trim()||(c.phone="Phone number is required"),v.bloodGroup||(c.bloodGroup="Blood group is required"),v.proofType||(c.proofType="Please select proof type"),v.proofFile?v.proofFile.size>1048576&&(c.proofFile="File size must be less than 1MB"):c.proofFile="Please upload proof document",v.permanentZip.trim()||(c.permanentZip="Permanent Zip Code is required"),v.presentZip.trim()||(c.presentZip="Present Zip Code is required"),y(c),0===Object.keys(c).length&&t){q("uploading"),s(25);try{let{data:{session:b},error:c}=await i.supabase.auth.getSession();if(c)throw c;if(!b){o("Authentication required. Please sign in again."),a.push("/login");return}if(b.user.id!==t.userId){o("Session mismatch. Please register again."),a.push("/register");return}let d=`${b.user.id}/${Date.now()}-${v.proofFile.name}`,{error:e}=await i.supabase.storage.from("proofs").upload(d,v.proofFile,{upsert:!1,contentType:v.proofFile.type});if(e)throw e;s(50),q("creating_profile");let{error:f}=await i.supabase.from("profiles").upsert({id:b.user.id,email:t.email,full_name:v.fullName,phone:v.phone,blood_group:v.bloodGroup,blood_group_proof_type:v.proofType,blood_group_proof_url:d,is_donor:!0,is_available:!0,permanent_zip:v.permanentZip,present_zip:v.presentZip,location:{latitude:0,longitude:0,address:""}},{onConflict:"id",ignoreDuplicates:!1});if(f)throw f;s(75),q("finalizing");let{error:g}=await i.supabase.auth.updateUser({data:{registration_completed:!0,phone:v.phone}});if(g)throw g;s(100),q("completed"),localStorage.removeItem("pendingRegistration"),setTimeout(()=>a.push("/dashboard"),1500)}catch(a){console.error("Registration completion error:",a),o(a.message||"Failed to complete registration"),q("error")}}},A=a=>{let b=a.target.files?.[0];b&&(b.size>1048576?y(a=>({...a,proofFile:"File size must be less than 1MB"})):(y(a=>{let b={...a};return delete b.proofFile,b}),w(a=>({...a,proofFile:b}))))};return(0,b.jsx)("div",{className:"max-w-md mx-auto",children:(0,b.jsx)(e.Card,{children:(0,b.jsx)(e.CardBody,{className:"text-center py-8",children:(()=>{switch(p){case"loading":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Loading Registration Data"}),(0,b.jsx)(j.Loader2,{className:"h-8 w-8 animate-spin text-primary-500"})]});case"form":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Complete Your Registration"}),n&&(0,b.jsx)(g.Alert,{variant:"error",className:"mb-4",children:n}),(0,b.jsxs)("form",{onSubmit:z,className:"space-y-4",children:[(0,b.jsx)(f.Input,{label:"Full Name",value:v.fullName,onChange:a=>w({...v,fullName:a.target.value}),required:!0,autoComplete:"name",placeholder:"Enter your full name",error:x.fullName}),(0,b.jsx)(f.Input,{label:"Phone Number",type:"tel",value:v.phone,onChange:a=>w({...v,phone:a.target.value}),required:!0,autoComplete:"tel",placeholder:"Enter your phone number",error:x.phone}),(0,b.jsx)(f.Select,{label:"Blood Group",value:v.bloodGroup,onChange:a=>w({...v,bloodGroup:a.target.value}),options:[{value:"",label:"Select Blood Group"},{value:"A+",label:"A+"},{value:"A-",label:"A-"},{value:"B+",label:"B+"},{value:"B-",label:"B-"},{value:"AB+",label:"AB+"},{value:"AB-",label:"AB-"},{value:"O+",label:"O+"},{value:"O+",label:"O+"},{value:"O-",label:"O-"}],required:!0,error:x.bloodGroup}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsx)(f.Input,{label:"Permanent Zip Code",value:v.permanentZip,onChange:a=>w({...v,permanentZip:a.target.value}),required:!0,placeholder:"e.g. 560001",error:x.permanentZip}),(0,b.jsx)(f.Input,{label:"Present Zip Code",value:v.presentZip,onChange:a=>w({...v,presentZip:a.target.value}),required:!0,placeholder:"e.g. 560001",error:x.presentZip})]}),(0,b.jsx)(f.Select,{label:"Blood Group Proof Type",value:v.proofType,onChange:a=>w({...v,proofType:a.target.value}),options:[{value:"",label:"Select Proof Type"},{value:"medical_certificate",label:"Medical Certificate"},{value:"hospital_report",label:"Hospital Report"},{value:"blood_donation_card",label:"Blood Donation Card"},{value:"lab_report",label:"Laboratory Report"}],required:!0,error:x.proofType}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700",children:"Upload Proof"}),(0,b.jsx)(f.Input,{type:"file",onChange:A,accept:".pdf,.jpg,.jpeg,.png",required:!0,className:"w-full",error:x.proofFile}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"Accepted formats: PDF, JPG, JPEG, PNG (Max size: 1MB)"})]}),(0,b.jsx)(h.Button,{type:"submit",variant:"primary",className:"w-full",children:"Complete Registration"})]})]});case"uploading":case"creating_profile":case"finalizing":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Completing Registration"}),(0,b.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-2.5 mb-4",children:(0,b.jsx)("div",{className:"bg-primary-500 h-2.5 rounded-full transition-all duration-500",style:{width:`${r}%`}})}),(0,b.jsxs)("p",{className:"text-gray-600",children:["uploading"===p&&"Uploading your documents...","creating_profile"===p&&"Creating your profile...","finalizing"===p&&"Finalizing your registration..."]})]});case"completed":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-green-600 mb-4",children:"Registration Complete!"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Your account has been successfully set up."}),(0,b.jsx)("p",{className:"text-gray-600",children:"Redirecting you to the dashboard..."})]});case"error":return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("h2",{className:"text-xl font-semibold text-red-600 mb-4",children:"Registration Error"}),(0,b.jsx)(g.Alert,{variant:"error",className:"mb-4",children:n}),(0,b.jsx)(h.Button,{variant:"primary",onClick:()=>a.push("/register"),className:"w-full",children:"Try Again"})]})}})()})})})}a.s(["default",()=>m])}];

//# sourceMappingURL=_5999c693._.js.map